[
  {
    "filepath": "content\\posts\\2020\\get-an-azure-service-principal-token-with-almost-one-line-in-powershell.md",
    "url": "posts/2020/get-an-azure-service-principal-token-with-almost-one-line-in-powershell",
    "year": 2020,
    "slug": "get-an-azure-service-principal-token-with-almost-one-line-in-powershell",
    "hash": "NMfNyeUs0hHhIO+6hZIkZX860fk=",
    "pageContent": "var Component=(()=>{var d=Object.create;var o=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var y=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty;var D=(l,e)=>()=>(e||l((e={exports:{}}).exports,e),e.exports),u=(l,e)=>{for(var r in e)o(l,r,{get:e[r],enumerable:!0})},c=(l,e,r,t)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let s of E(e))!F.call(l,s)&&s!==r&&o(l,s,{get:()=>e[s],enumerable:!(t=p(e,s))||t.enumerable});return l};var C=(l,e,r)=>(r=l!=null?d(y(l)):{},c(e||!l||!l.__esModule?o(r,\"default\",{value:l,enumerable:!0}):r,l)),m=l=>c(o({},\"__esModule\",{value:!0}),l);var i=D((k,a)=>{a.exports=_jsx_runtime});var f={};u(f,{default:()=>w,frontmatter:()=>A});var n=C(i()),A={title:\"Get an Azure Service Principal Token With (Almost) One-Line in PowerShell\",metaDesc:\"A short and sweet way to retrieve an Azure SP token\",headerImage:\"/assets/posts/2020/get-an-azure-service-principal-token-with-almost-one-line-in-powershell-1.png\",date:new Date(15886368e5),tags:[\"azure\",\"powershell\"]};function h(l){let e=Object.assign({h1:\"h1\",p:\"p\",div:\"div\",pre:\"pre\",code:\"code\",span:\"span\",a:\"a\",img:\"img\"},l.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.h1,{id:\"get-an-azure-service-principal-token-with-almost-one-line-in-powershell\",children:\"Get an Azure Service Principal Token With (Almost) One-Line in PowerShell\"}),`\n`,(0,n.jsx)(e.p,{children:\"I had a recent issue where I needed to run a DACPAC against an Azure Synapse Warehouse. The problem I ran in to was that our DACPAC needed to insert AAD users in to the SQL Server users pool, but in order to do that via DACPAC you must authenticate in to the Warehouse using an AAD account instead of SQL Credentials. We already had a service principal that was in charge of our Terraform deployments, so we decided to co-opt it into running the DACPAC as well.\"}),`\n`,(0,n.jsx)(e.p,{children:\"I ran across many different ways to get an Access Token for an Azure Service Principal, but nearly all of them were outdated or flat-out wrong. The ones that did work were over engineered PS scripts that did far more than was necessary to retrieve an access token.\"}),`\n`,(0,n.jsx)(e.p,{children:\"So after reading through a bunch of blog posts and comparing scripts, I am happy to present to you the simplest way to retrieve an Access Token for an Azure Service Principal (in PowerShell):\"}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"powershell\",\"data-theme\":\"default\",children:(0,n.jsxs)(e.code,{\"data-language\":\"powershell\",\"data-theme\":\"default\",children:[(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Fields\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"@\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"grant_type\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"client_credentials\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"client_id\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"     \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"<service-principal-id>\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"resource\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"<resource-id-to-auth-for-or-url>\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"client_secret\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"<service-principal-secret>\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"response\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"Invoke-RestMethod\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"`\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"-\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"Uri \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"https://login.microsoftonline.com/<azure-tenant-id>/oauth2/token\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"`\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"-\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"ContentType \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"application/x-www-form-urlencoded\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"`\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"-\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"Method POST \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"`\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"-\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"Body \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Fields\"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,n.jsx)(e.span,{className:\"line\"}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"Write-Output\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"tokenResponse.access_token\"})]})]})})}),`\n`,(0,n.jsxs)(e.p,{children:[\"This almost one-liner will authenticate the Service Principal against the target resource, and return the Access Token back to you for use in other processes. The Service Principal must be able to authenticate with the target resource, so make sure to add it directly, or put it in a group that grants access to the target resource. The resource can either be a resource GUID, or a service url like \",(0,n.jsx)(e.a,{href:\"https://database.windows.net\",children:\"https://database.windows.net\"}),\". Your use case will determine how you need to set it.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"The access_token can then be checked with something like JWT.io to verify the payload:\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/posts/2020/get-an-azure-service-principal-token-with-almost-one-line-in-powershell-1.png\",alt:\"Image1\",width:\"891\",height:\"616\"})}),`\n`,(0,n.jsx)(e.p,{children:\"That\\u2019s it, just pass the token in to whatever process needs it and you\\u2019re good to go.\"})]})}function g(l={}){let{wrapper:e}=l.components||{};return e?(0,n.jsx)(e,Object.assign({},l,{children:(0,n.jsx)(h,l)})):h(l)}var w=g;return m(f);})();\n;return Component;"
  },
  {
    "filepath": "content\\posts\\2020\\get-state-outputs-from-terraform-io-api.md",
    "url": "posts/2020/get-state-outputs-from-terraform-io-api",
    "year": 2020,
    "slug": "get-state-outputs-from-terraform-io-api",
    "hash": "OOrz8MCPgOE2l5m01VavVi3eyCc=",
    "pageContent": "var Component=(()=>{var h=Object.create;var o=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var y=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty;var D=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),C=(n,e)=>{for(var r in e)o(n,r,{get:e[r],enumerable:!0})},a=(n,e,r,c)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let s of E(e))!F.call(n,s)&&s!==r&&o(n,s,{get:()=>e[s],enumerable:!(c=d(e,s))||c.enumerable});return n};var u=(n,e,r)=>(r=n!=null?h(y(n)):{},a(e||!n||!n.__esModule?o(r,\"default\",{value:n,enumerable:!0}):r,n)),m=n=>a(o({},\"__esModule\",{value:!0}),n);var i=D(($,t)=>{t.exports=_jsx_runtime});var w={};C(w,{default:()=>g,frontmatter:()=>A});var l=u(i()),A={title:\"Get State Outputs from Terraform.io API\",metaDesc:\"Ever wished you could easily access Terraform Cloud outputs within a CI/CD context? This is a simple way to do so.\",headerImage:\"/assets/posts/2020/get-state-outputs-from-terraform-io-api-1.png\",date:new Date(1594944e6),tags:[\"terraform\",\"powershell\"]};function p(n){let e=Object.assign({h1:\"h1\",p:\"p\",ul:\"ul\",li:\"li\",div:\"div\",pre:\"pre\",code:\"code\",span:\"span\",img:\"img\",a:\"a\",h2:\"h2\"},n.components);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.h1,{id:\"get-state-outputs-from-terraformio-api\",children:\"Get State Outputs from Terraform.io API\"}),`\n`,(0,l.jsx)(e.p,{children:\"Terraform.io has been online for awhile now, and I've been enjoying having a cloud agnostic place to store my state files. What many people may not know is that Terraform.io has an API that provides all the same functionality as the web UI. This is a simple example of how to leverage the Terraform.io API to aid your deployment by retrieving Terraform outputs.\"}),`\n`,(0,l.jsx)(e.p,{children:\"One issue that always bugged me was needing to repeatedly get my current set of Terraform outputs during a multi-stage deployment. Usually these outputs are passed upstream for configuration or linking of services that Terraform cannot control. It used to be the only way to get these outputs was either run \\u201Cterraform output -format json\\u201D on your build server and then parse the results, or manually download the remote state file and parse that. Both of these require tooling and engineering time to work through. It always felt like an over-engineered solution for what could be simple.\"}),`\n`,(0,l.jsx)(e.p,{children:\"Well complain no longer, the Terraform.io API makes this a snap. The following PowerShell script takes 3 arguments:\"}),`\n`,(0,l.jsxs)(e.ul,{children:[`\n`,(0,l.jsx)(e.li,{children:\"WorkspaceName\"}),`\n`,(0,l.jsx)(e.li,{children:\"Organization Name\"}),`\n`,(0,l.jsx)(e.li,{children:\"Terraform.IO Team/User token (org tokens don't work on the state-versions endpoint)\"}),`\n`]}),`\n`,(0,l.jsx)(e.p,{children:\"Pass those three items in to the script and you'll get back a dictionary of the outputs for the specified environment. The only prerequisite is that your are using Terraform.io to hold your state files.\"}),`\n`,(0,l.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,l.jsx)(e.pre,{\"data-language\":\"powershell\",\"data-theme\":\"default\",children:(0,l.jsxs)(e.code,{\"data-language\":\"powershell\",\"data-theme\":\"default\",children:[(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"param\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"string\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"]\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"workspaceName\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"$(\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"throw\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Please specify a workspace name\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"string\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"]\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"organizationName\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"$(\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"throw\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Please specify an organization name\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"string\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"]\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"terraformIoToken\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"$(\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"throw\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Please specify a terraform Io Token\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$ErrorActionPreference\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Stop\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"baseUri\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"https://app.terraform.io/\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"authHeader\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"@\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Authorization\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Bearer \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"terraformIoToken\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"contentType\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"application/vnd.api+json; charset=utf-8\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"Write-Host\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Getting state information for \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"organizationName\"}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\" - \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"workspaceName\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"workspaceResp\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"Invoke-RestMethod\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"-\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"Uri \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"baseUri\"}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"/api/v2/organizations/\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"organizationName\"}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"/workspaces/\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"workspaceName\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"-\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"Headers \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"authHeader\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"-\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"ContentType \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"contentType\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"currentStateVersionLink\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"workspaceResp.data.relationships\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"current-state-version\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\".links.related\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"Write-Host\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Current state link: \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"currentStateVersionLink\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"uri\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"baseUri\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"+\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"currentStateVersionLink\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"+\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"?include=outputs\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"outputResp\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"Invoke-RestMethod\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"-\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"Uri \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"uri\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"-\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"Headers \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"authHeader\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"-\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"ContentType \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"contentType\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"outputs\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"@\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{}\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"outputResp.included\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"%\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" attributes \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"%\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"outputs\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"$(\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"_\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\".Name\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"_\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\".Value\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"outputs\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"outputs.GetEnumerator\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" sort \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"-\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"Property Name\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"outputs\"})]})]})})}),`\n`,(0,l.jsx)(e.p,{children:\"From here, you've got a PowerShell hashmap of Terraform outputs that you can integrate back into your build pipeline. No download/install of Terraform and no manual parsing of JSON. The example is in PowerShell, but it could easily be adapted to any other language with minimal fuss. I should say that all outputs will be printed in the console, so alter the script to hide these if necessary. I intentionally left them visible for the sake of keeping this simple.\"}),`\n`,(0,l.jsx)(e.p,{children:(0,l.jsx)(e.img,{src:\"/assets/posts/2020/get-state-outputs-from-terraform-io-api-1.png\",alt:\"Image1\",width:\"900\",height:\"441\"})}),`\n`,(0,l.jsxs)(e.p,{children:[\"The full docs for the Terraform.io API are \",(0,l.jsx)(e.a,{href:\"https://www.terraform.io/docs/cloud/api/index.html\",children:\"here\"}),\".\"]}),`\n`,(0,l.jsx)(e.h2,{id:\"github-action---3182021\",children:\"GitHub Action - 3/18/2021\"}),`\n`,(0,l.jsx)(e.p,{children:\"I've created a simple GitHub action that wraps this up in a single step, so if you're using Actions you may consider just using it instead.\"}),`\n`,(0,l.jsx)(e.p,{children:(0,l.jsx)(e.a,{href:\"https://github.com/bruceharrison1984/terraform-io-github-action\",children:\"https://github.com/bruceharrison1984/terraform-io-github-action\"})})]})}function f(n={}){let{wrapper:e}=n.components||{};return e?(0,l.jsx)(e,Object.assign({},n,{children:(0,l.jsx)(p,n)})):p(n)}var g=f;return m(w);})();\n;return Component;"
  },
  {
    "filepath": "content\\posts\\2020\\query-azure-resource-management-from-an-azure-function-c.md",
    "url": "posts/2020/query-azure-resource-management-from-an-azure-function-c",
    "year": 2020,
    "slug": "query-azure-resource-management-from-an-azure-function-c",
    "hash": "pzyyXHIoz5jx+hHHzMhk1XQeUMw=",
    "pageContent": "var Component=(()=>{var h=Object.create;var c=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var F=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty;var D=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),C=(n,e)=>{for(var s in e)c(n,s,{get:e[s],enumerable:!0})},a=(n,e,s,o)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let r of p(e))!y.call(n,r)&&r!==s&&c(n,r,{get:()=>e[r],enumerable:!(o=E(e,r))||o.enumerable});return n};var u=(n,e,s)=>(s=n!=null?h(F(n)):{},a(e||!n||!n.__esModule?c(s,\"default\",{value:n,enumerable:!0}):s,n)),m=n=>a(c({},\"__esModule\",{value:!0}),n);var t=D((v,i)=>{i.exports=_jsx_runtime});var f={};C(f,{default:()=>N,frontmatter:()=>A});var l=u(t()),A={title:\"Query Azure Resource Management from an Azure Function (C#)\",metaDesc:\"This explains how to use the Azure Resource Management library for C# to query resources\",date:new Date(1604448e6),tags:[\"azure\",\"c#\"]};function d(n){let e=Object.assign({h1:\"h1\",p:\"p\",div:\"div\",pre:\"pre\",code:\"code\",span:\"span\",h2:\"h2\",ul:\"ul\",li:\"li\",a:\"a\"},n.components);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.h1,{id:\"query-azure-resource-management-from-an-azure-function-c\",children:\"Query Azure Resource Management from an Azure Function (C#)\"}),`\n`,(0,l.jsx)(e.p,{children:\"I had a recent requirement to write a small program that monitors an Azure DataLake, and writes entries in to an Azure Synapse database when certain changes occur. It was a simple enough requirement, but the most difficult part turned out to be checking if the Synapse database was actually online. Synapse can be paused, which is not good when I am supposed to be writing in to it. The SDK currently doesn\\u2019t expose this value directly, so we had to find a way to get it ourselves.\"}),`\n`,(0,l.jsx)(e.p,{children:\"An Additional wrinkle was an Azure Function would be running the code, and I wanted to avoid any unnecessary environment variable magic on my local machine. So platform independence was a hard requirement I set for myself.\"}),`\n`,(0,l.jsx)(e.p,{children:\"The Azure SDK ecosystem for C# is generally a train-wreck, with multiple packages deprecated and they all share very similar namespaces. After much Googling and reading, I found the current set of SDKs to use to do this. (As of 11/4/2020). The ResourceManagementClient used here is currently still in beta, but it seems clear that Microsoft is moving in this direction.\"}),`\n`,(0,l.jsx)(e.p,{children:`Example\nI am using the DI package for Azure Functions, so if you are not using it(why not?) you will need to slightly adapt this to get it working in your project. The example is also intentionally verbose to make it clear what we are doing.`}),`\n`,(0,l.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,l.jsx)(e.pre,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:(0,l.jsxs)(e.code,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:[(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" Azure.Identity\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" Azure.ResourceManager.Resources\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" MyFunctionProject.Models\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" Microsoft.Extensions.Logging\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" Microsoft.Extensions.Options\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" System\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" System.Collections.Generic\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" System.Threading\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" System.Threading.Tasks\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"namespace\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" MyFunctionProject\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"Services\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"interface\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" IAzureResourceManagementApiService\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        Task\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"bool\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"IsSynapseOnlineAsync\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"CancellationToken cancellationToken\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"class\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"AzureResources\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" IAzureResourceManagementApiService\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"private\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"readonly\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" IOptions\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"AzureConfig\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" _azureConfig\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"private\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"readonly\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" ISqlConnectionService _connectionService\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"private\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"readonly\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" ILogger\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"AzureResources\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" _logger\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"AzureResources\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"IOptions\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"AzureConfig\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" azureConfig\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" ISqlConnectionService connectionService\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" ILogger\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"AzureResources\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" logger\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"_azureConfig\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"azureConfig\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"_connectionService\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"connectionService\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"_logger\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"logger\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"async\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" Task\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"bool\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"IsSynapseOnlineAsync\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"CancellationToken cancellationToken\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"var\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" resourceClient \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" ResourcesManagementClient\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"_azureConfig\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Value\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"SubscriptionId\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" DefaultAzureCredential\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"())\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"var\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" resp \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"await\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"resourceClient\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Resources\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"GetAsync\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"_azureConfig\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Value\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"ResourceGroup\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'$\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Microsoft.Sql/servers\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"_connectionService\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"DatabaseServerName\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"databases\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"_connectionService\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"DatabaseName\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"2020-08-01-preview\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"cancellationToken\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"var\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" props \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"Dictionary\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"string\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"object\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\">)\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"resp\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Value\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Properties\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"if\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"!\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"props\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"ContainsKey\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"status\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"))\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"throw\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" Exception\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'$\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Querying Azure Resource Management for '\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"_connectionService\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"DatabaseServerName\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"/\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"_connectionService\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"DatabaseName\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"' did not return the expected response. 'status' key not found in resource properties.\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"var\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" status \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"string\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"props\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"status\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"]\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"switch\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"status\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"ToLower\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"())\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"case\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"online\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                    \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"return\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"true;\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"default\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                        \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"_logger\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"LogWarning\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'$\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Synapse database '\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"_connectionService\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"DatabaseServerName\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"/\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"_connectionService\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"DatabaseName\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"' is not online, it is '\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"status\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                        \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"return\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"false;\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})})]})})}),`\n`,(0,l.jsx)(e.p,{children:\"It is a fairly simple little class, and can almost be copy pasted right in to another project. In my case I have an ISqlConnection class that you won\\u2019t have, but as long as you can pass in the DatabaseName and DatabaseServerName through some other means, it should work just fine. You will also need to pass in a SubscriptionID as well as a resource group. I made a small class (AzureConfig) to hold these values and I pass them in as IOptions.\"}),`\n`,(0,l.jsx)(e.h2,{id:\"additional-info\",children:\"Additional Info\"}),`\n`,(0,l.jsx)(e.p,{children:\"This uses the new ResourceManagementClient paired with Azure.Identity. The Identity package exposes the DefaultAzureCredential() method. This method will use your local Azure credentials when developing, and use the Managed Identity of the Azure service you deploy it to. So there is no extra work needed to ensure what runs locally will run once deployed(ignoring any IAM permissions that need to be set on the Azure side).\"}),`\n`,(0,l.jsx)(e.p,{children:\"My biggest complaint with the ResourceManagementClient is that it requires the SubscriptionID, as well as a ResourceGroup in order to even initialize. This requires feeding them in to the application, since there isn\\u2019t a good way through the SDK to retrieve these values.\"}),`\n`,(0,l.jsx)(e.p,{children:\"You could easily adapt this to query any Azure resources, so long as you have the necessary resource IDs/names to pass in to the ResourceManagementClient. It\\u2019s also worth pointing out that resourceClient.Resources.GetAsync() is simply building up an Azure Resource Manager REST Url, so you can use the Azure Portal and browser inspection tools to quickly figure out what these values need to be.\"}),`\n`,(0,l.jsx)(e.h2,{id:\"references\",children:\"References\"}),`\n`,(0,l.jsxs)(e.ul,{children:[`\n`,(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:\"https://docs.microsoft.com/en-us/dotnet/api/overview/azure/identity-readme#examples\",children:\"Azure Credentials Examples\"})}),`\n`,(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:\"https://www.nuget.org/packages/Microsoft.Azure.Management.ResourceManager\",children:\"ResourceManagement Nuget Package\"})}),`\n`,(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:\"https://www.nuget.org/packages/Azure.Identity\",children:\"Azure.Identity Nuget Package\"})}),`\n`]})]})}function g(n={}){let{wrapper:e}=n.components||{};return e?(0,l.jsx)(e,Object.assign({},n,{children:(0,l.jsx)(d,n)})):d(n)}var N=g;return m(f);})();\n;return Component;"
  },
  {
    "filepath": "content\\posts\\2020\\running-a-dacpac-on-azure-synapse-from-a-devops-hosted-agent.md",
    "url": "posts/2020/running-a-dacpac-on-azure-synapse-from-a-devops-hosted-agent",
    "year": 2020,
    "slug": "running-a-dacpac-on-azure-synapse-from-a-devops-hosted-agent",
    "hash": "WTPBY1CSLKuLL+l+19SnV1Pb7BQ=",
    "pageContent": "var Component=(()=>{var p=Object.create;var r=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var E=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var F=(l,e)=>()=>(e||l((e={exports:{}}).exports,e),e.exports),D=(l,e)=>{for(var s in e)r(l,s,{get:e[s],enumerable:!0})},t=(l,e,s,a)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let o of y(e))!u.call(l,o)&&o!==s&&r(l,o,{get:()=>e[o],enumerable:!(a=h(e,o))||a.enumerable});return l};var C=(l,e,s)=>(s=l!=null?p(E(l)):{},t(e||!l||!l.__esModule?r(s,\"default\",{value:l,enumerable:!0}):s,l)),g=l=>t(r({},\"__esModule\",{value:!0}),l);var i=F((S,c)=>{c.exports=_jsx_runtime});var f={};D(f,{default:()=>w,frontmatter:()=>m});var n=C(i()),m={title:\"Running a DACPAC On Azure Synapse From a DevOps-Hosted Agent\",metaDesc:\"Fix for running a DACPAC against Synapse on DevOps runners that don't support it\",date:new Date(15886368e5),tags:[\"azure\",\"powershell\",\"synapse\"]};function d(l){let e=Object.assign({h1:\"h1\",p:\"p\",div:\"div\",pre:\"pre\",code:\"code\",span:\"span\"},l.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.h1,{id:\"running-a-dacpac-on-azure-synapse-from-a-devops-hosted-agent\",children:\"Running a DACPAC On Azure Synapse From a DevOps-Hosted Agent\"}),`\n`,(0,n.jsx)(e.p,{children:\"We recently needed to run a DACPAC against a Synapse Warehouse. Locally running the DACPAC against Synapse worked fine, but broke as soon as we tried to use our DevOps CI/CD pipeline.\"}),`\n`,(0,n.jsx)(e.p,{children:\"We got the following error from the DACPAC release task:\"}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"sh\",\"data-theme\":\"default\",children:(0,n.jsxs)(e.code,{\"data-language\":\"sh\",\"data-theme\":\"default\",children:[(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#B48EAD\"},children:\"2020\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"-\"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"0\"}),(0,n.jsx)(e.span,{style:{color:\"#B48EAD\"},children:\"5\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"-01T19:\"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"0\"}),(0,n.jsx)(e.span,{style:{color:\"#B48EAD\"},children:\"6\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\":05.0948538Z \"}),(0,n.jsx)(e.span,{style:{color:\"#616E88\"},children:\"##[error]Publishing to database '****' on server '***.database.windows.net,1433'.\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"Initializing \"}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"deployment\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"Start\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"Initializing \"}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"deployment\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"Failed\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"Time \"}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"elapsed\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"0\"}),(0,n.jsx)(e.span,{style:{color:\"#B48EAD\"},children:\"0\"}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\":\"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"0\"}),(0,n.jsx)(e.span,{style:{color:\"#B48EAD\"},children:\"0\"}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\":\"}),(0,n.jsx)(e.span,{style:{color:\"#B48EAD\"},children:\"06.91\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"***\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" An error occurred during deployment plan generation. Deployment cannot continue. The Element class SqlColumnStoreIndex does not contain the Relationship class OrderedColumns.\"})]})]})})}),`\n`,(0,n.jsx)(e.p,{children:\"A quick Google search showed that the column types used in Synapse aren\\u2019t supported by SqlPackage.exe until v19. All of the DevOps Release tasks that use SqlPackage.exe rely on v18.5, which causes the deployment to fail due to missing types. Visual Studio 2019 ships with v19, so that\\u2019s why it worked locally. In an odd twist, there currently are not any links to download SqlPackage.exe v19, so your only source is VS2019. I\\u2019m sure this will be updated eventually.\"}),`\n`,(0,n.jsx)(e.p,{children:\"After a bit of sniffing around on the DevOps agent, I found that v19 of SqlPackage.exe is present, you just have to call it manually using Powershell(or whatever shell task you prefer).\"}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"powershell\",\"data-theme\":\"default\",children:(0,n.jsxs)(e.code,{\"data-language\":\"powershell\",\"data-theme\":\"default\",children:[(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"connectionString\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Server=*****.database.windows.net,1433;Database=*****;Trusted_Connection=False;Encrypt=True;Connection Timeout=30;\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,n.jsx)(e.span,{className:\"line\"}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"&\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"C:\\\\Program Files (x86)\\\\Microsoft Visual Studio\\\\2019\\\\Enterprise\\\\Common7\\\\IDE\\\\Extensions\\\\Microsoft\\\\SQLDB\\\\DAC\\\\150\\\\sqlpackage.exe\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"/\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"Action:Publish \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"/\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"SourceFile:\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"./deployment.dacpac\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"/\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"TargetConnectionString:\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"connectionString\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"/\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"AccessToken:\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"<service-principal-access-token>\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"/\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"Diagnostics:True\"})]})]})})}),`\n`,(0,n.jsx)(e.p,{children:\"Once we switched to using this version of SqlPackage.exe, our DACPAC deployment was able to proceed successfully.\"}),`\n`,(0,n.jsx)(e.p,{children:\"In this example we invoke SqlPackage with an Azure Service Principal, but you can also use username/password credentials. If using username/password, you can remove the AccessToken argument from the SqlPackage call, and change your connection string to resemble the following:\"}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"powershell\",\"data-theme\":\"default\",children:(0,n.jsx)(e.code,{\"data-language\":\"powershell\",\"data-theme\":\"default\",children:(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"$\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"connectionString\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Server=*****.database.windows.net,1433;Database=*****;Persist Security Info=False;User ID=<username@domain.com>;Password=<password>;Pooling=False;MultipleActiveResultSets=False;Connect Timeout=60;Encrypt=True;TrustServerCertificate=False;Authentication='Active Directory Password'\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]})})})}),`\n`,(0,n.jsx)(e.p,{children:\"I would imagine in time the DACPAC tasks will be updated to use v19+ of SqlPackage.exe, but as of today(5/5/2020) this is the only way to get it to work without resorting to deploying your own DevOps agent.\"})]})}function A(l={}){let{wrapper:e}=l.components||{};return e?(0,n.jsx)(e,Object.assign({},l,{children:(0,n.jsx)(d,l)})):d(l)}var w=A;return g(f);})();\n;return Component;"
  },
  {
    "filepath": "content\\posts\\2019\\azure-function-filters.md",
    "url": "posts/2019/azure-function-filters",
    "year": 2019,
    "slug": "azure-function-filters",
    "hash": "6TFJ52SF+nAAPJRh8U/UytMDg4w=",
    "pageContent": "var Component=(()=>{var E=Object.create;var o=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var F=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty;var D=(n,l)=>()=>(l||n((l={exports:{}}).exports,l),l.exports),C=(n,l)=>{for(var s in l)o(n,s,{get:l[s],enumerable:!0})},a=(n,l,s,c)=>{if(l&&typeof l==\"object\"||typeof l==\"function\")for(let r of p(l))!y.call(n,r)&&r!==s&&o(n,r,{get:()=>l[r],enumerable:!(c=h(l,r))||c.enumerable});return n};var u=(n,l,s)=>(s=n!=null?E(F(n)):{},a(l||!n||!n.__esModule?o(s,\"default\",{value:n,enumerable:!0}):s,n)),m=n=>a(o({},\"__esModule\",{value:!0}),n);var i=D((N,t)=>{t.exports=_jsx_runtime});var w={};C(w,{default:()=>f,frontmatter:()=>g});var e=u(i()),g={title:\"Azure Functions V2 - Filters (without Filters)\",metaDesc:\"An elaborate experiment to see how viable using ECS/Fargate for a persistent bastion host really is\",date:new Date(15670368e5),tags:[\"azure\",\"azure functions\"]};function d(n){let l=Object.assign({h1:\"h1\",p:\"p\",h2:\"h2\",div:\"div\",pre:\"pre\",code:\"code\",span:\"span\",ul:\"ul\",li:\"li\"},n.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(l.h1,{id:\"azure-functions-v2---filters-without-filters\",children:\"Azure Functions V2 - Filters (without Filters)\"}),`\n`,(0,e.jsx)(l.p,{children:\"Recently, I was tasked with building a fairly simple API using Azure Functions. Using VS2019, this is a trivial task because VS2019 comes with an Azure Function V2 project type. The addition of DI in V2 functions is also a major boon, because it finally gets rid of the code sprawl and duplication that previous lambda function competitors (I'm looking at you AWS) suffered from.\"}),`\n`,(0,e.jsx)(l.p,{children:\"I quickly realized that as nice as it is to have DI in Azure Functions, there is a huge gaping hole where asp.net middleware is supposed to live. Azure functions technically have Filter support, the problem is that the current implementation cannot alter the response of the function. Because of this limitation, a global error response handler isn't feasible, at least right now. There is currently an open issue on Github around the issue, and it looks like we might get the functionality most people are asking for by the end of 2019.\"}),`\n`,(0,e.jsx)(l.p,{children:\"But since you are reading this, you need a filter right now! If that's the case, read on!\"}),`\n`,(0,e.jsx)(l.h2,{id:\"dependencies\",children:\"Dependencies\"}),`\n`,(0,e.jsx)(l.p,{children:\"All the examples here assume you are using Azure Functions V2, and Azure Functions DI. The examples are written as though you are using Entity Framework, but they are applicable to any DB/ORM implementation.\"}),`\n`,(0,e.jsx)(l.h2,{id:\"standard-error-handler\",children:\"Standard Error Handler\"}),`\n`,(0,e.jsx)(l.p,{children:\"Anyone who has written an asp.net API will be familiar with the error handler middleware. This lets us catch any unhandled exceptions that may have bubbled up from the depths of our app, and apply a standard error response. Normally this includes an HTTP status of 500, and some form of ambiguous error message. In ASP.net, you can leverage middleware and be done with it. If you attempt to implement the same thing in Azure Functions, without filters or middleware, your first attempt will likely be to wrap all of your functions in try/catch blocks.\"}),`\n`,(0,e.jsx)(l.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,e.jsx)(l.pre,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:(0,e.jsxs)(l.code,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:[(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"FunctionName\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"GetWidget\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")]\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"async\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Task \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" IActionResult \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"GetWidget\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"([\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"HttpTrigger\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"AuthorizationLevel\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Anonymous\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"get\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Route \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"/widgets/{id}\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")]\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" HttpRequest req\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"int\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" id\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" ILogger log\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"log\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"LogInformation\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'$\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"getting widget: $\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"id\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'}\"'}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"try\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"var\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" selectedItem \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"await\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"_dbContext\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Widgets\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"FindAsync\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"id\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"return\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"new\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" ObjectResult\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"selectedItem\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"catch\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"Exception e\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"return\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"new\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" CustomObjectResult\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"e\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Message\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"StatusCodes\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Status500InternalServerError\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsx)(l.span,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"class\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8FBCBB\"},children:\"CustomObjectResult\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" ObjectResult \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"CustomObjectResult\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"object\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" data\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"int\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" statusCode\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"):\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"base\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"data\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"this\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"StatusCode\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"statusCode\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsx)(l.span,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})})]})})}),`\n`,(0,e.jsx)(l.p,{children:\"So the above works okay for a few endpoints. We get a 500 back if we failed to catch any errors, as well as the error message. Once our API grows to 10+ endpoints, you'll be doing quite a bit of copy/pasting for such a simple operation. The odds of fat fingering part of the code grows with each endpoint, and let's not talk about if we decide to change the response type. Let's see how we can consolidate this error handling logic by creating a new class.\"}),`\n`,(0,e.jsx)(l.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,e.jsx)(l.pre,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:(0,e.jsxs)(l.code,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:[(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"class\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8FBCBB\"},children:\"FunctionWrapper\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"private\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"readonly\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" ILogger _log\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"FunctionWrapper\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"ILogger \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" FunctionWrapper \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" log\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"_log\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"log\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"async\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Task \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" IActionResult \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"Execute\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"Func \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Task \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" IActionResult \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">>\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" azureFunction\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"try\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"return\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"await\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"azureFunction\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"catch\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"Exception e\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"_log\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"LogError\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"e\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"Unhandled exception occured in FunctionWrapper\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"return\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"new\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" CustomObjectResult\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"e\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Message\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"StatusCodes\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Status500InternalServerError\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsx)(l.span,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})})]})})}),`\n`,(0,e.jsx)(l.p,{children:\"The class itself is very simple. The Execute function takes one argument, a function with a return type of IActionResult. It just so happens that your original function logic returned an IActionResult, so we can utilize an inline lambda function in our function method. Now that we have our new function wrapper, let's implement it in to our API. The first step is injecting our wrapper in to the service collection.\"}),`\n`,(0,e.jsx)(l.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,e.jsx)(l.pre,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:(0,e.jsx)(l.code,{\"data-line-numbers\":\"\",\"data-language\":\"csharp\",\"data-theme\":\"default\",\"data-line-numbers-max-digits\":\"1\",children:(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"builder\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Services\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"AddTransient\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"FunctionWrapper\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">()\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]})})})}),`\n`,(0,e.jsx)(l.p,{children:\"Now we can utilize our wrapper in our Function code. You could also make use of a static class instead of using a DI container, but testing static classes is difficult and it doesn't really buy us anything in this scenario anyway.\"}),`\n`,(0,e.jsx)(l.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,e.jsx)(l.pre,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:(0,e.jsxs)(l.code,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:[(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"class\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8FBCBB\"},children:\"Widgets\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"private\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"readonly\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" DbContext _DbContext\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"private\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"readonly\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" FunctionWrapper _functionWrapper\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"Widgets\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"DbContext DbContext\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" FunctionWrapper functionWrapper\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"_DbContext\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"DbContext\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"_functionWrapper\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"functionWrapper\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"FunctionName\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"GetWidget\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")]\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"async\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Task \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" IActionResult \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"GetWidget\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"([\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"HttpTrigger\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"AuthorizationLevel\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Anonymous\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"get\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Route \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"/widgets/{id}\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")]\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" HttpRequest req\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"int\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" id\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" ILogger log\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"return\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"await\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"_functionWrapper\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"Execute\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"async\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=>\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"log\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"LogInformation\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'$\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"getting widget: $\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"id\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'}\"'}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"var\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" selectedItem \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"await\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"_DbContext\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Widgets\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"FindAsync\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"id\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"return\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"new\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" CustomObjectResult\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"selectedItem\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"StatusCodes\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Status200OK\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"})\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsx)(l.span,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})})]})})}),`\n`,(0,e.jsx)(l.p,{children:\"That's it! By injecting the FunctionWrapper class in to your Azure function classes, you can now reuse this simple wrapper in all of your functions. The nice thing about using an inline lambda is that while our business logic is wrapped in an error handler, we still have access to the variables outside of our wrapper scope. So we have consolidated our error handling without obscuring the intent of the original code.\"}),`\n`,(0,e.jsx)(l.h2,{id:\"conclusion\",children:\"Conclusion\"}),`\n`,(0,e.jsx)(l.p,{children:\"With a bit of C# knowledge, you can see how we took a potential maintenance nightmare and made a nice, concise error handler.\"}),`\n`,(0,e.jsx)(l.p,{children:\"This same idea could also be applied to many other ASP.net niceties we take for granted:\"}),`\n`,(0,e.jsxs)(l.ul,{children:[`\n`,(0,e.jsx)(l.li,{children:\"Model Validation\"}),`\n`,(0,e.jsx)(l.li,{children:\"Injecting User Context\"}),`\n`,(0,e.jsx)(l.li,{children:\"Sending all requests to a message bus\"}),`\n`]}),`\n`,(0,e.jsx)(l.p,{children:\"By pulling standard actions out we can expose the core functionality of our Azure Function, while at the same time consolidating shared logic in one place. It's a win-win!\"})]})}function A(n={}){let{wrapper:l}=n.components||{};return l?(0,e.jsx)(l,Object.assign({},n,{children:(0,e.jsx)(d,n)})):d(n)}var f=A;return m(w);})();\n;return Component;"
  },
  {
    "filepath": "content\\posts\\2019\\azure-v2-functions-with-fluentvalidation.md",
    "url": "posts/2019/azure-v2-functions-with-fluentvalidation",
    "year": 2019,
    "slug": "azure-v2-functions-with-fluentvalidation",
    "hash": "0DEZq2VtcpBLFjh7KrKZ1KDjCUk=",
    "pageContent": "var Component=(()=>{var E=Object.create;var c=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var F=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty;var D=(n,l)=>()=>(l||n((l={exports:{}}).exports,l),l.exports),C=(n,l)=>{for(var s in l)c(n,s,{get:l[s],enumerable:!0})},a=(n,l,s,o)=>{if(l&&typeof l==\"object\"||typeof l==\"function\")for(let r of h(l))!y.call(n,r)&&r!==s&&c(n,r,{get:()=>l[r],enumerable:!(o=p(l,r))||o.enumerable});return n};var u=(n,l,s)=>(s=n!=null?E(F(n)):{},a(l||!n||!n.__esModule?c(s,\"default\",{value:n,enumerable:!0}):s,n)),m=n=>a(c({},\"__esModule\",{value:!0}),n);var t=D((w,i)=>{i.exports=_jsx_runtime});var f={};C(f,{default:()=>N,frontmatter:()=>A});var e=u(t()),A={title:\"Azure V2 Functions - FluentValidation\",metaDesc:\"Setup an Azure Function project with seamless request validation\",date:new Date(15675552e5),tags:[\"azure\",\"c#\"]};function d(n){let l=Object.assign({h1:\"h1\",p:\"p\",em:\"em\",div:\"div\",pre:\"pre\",code:\"code\",span:\"span\",h2:\"h2\",blockquote:\"blockquote\",ul:\"ul\",li:\"li\"},n.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(l.h1,{id:\"azure-v2-functions---fluentvalidation\",children:\"Azure V2 Functions - FluentValidation\"}),`\n`,(0,e.jsx)(l.p,{children:(0,e.jsx)(l.em,{children:\"This walkthrough makes extensive use of inheritance and generics, so read up on those if anything here doesn't make sense to you.\"})}),`\n`,(0,e.jsx)(l.p,{children:\"The Azure Function V2 addition of being able to accept a typed model as a function parameter makes it easy and type-safe to interact with incoming JSON payloads.\"}),`\n`,(0,e.jsx)(l.p,{children:\"The downside to this approach is that you only get basic pass/fail model validation from the Azure Function. Fine grained error messages based on the content of the object aren't possible with the OOTB model validation. Worse still, due to the absence of Filter/Middleware, there isn't any good place we can hook in to the default model validation. To get the level of control we desire, we are going to use the FluentValidation Nuget package. This package has been around for nearly 10 years, is wildly popular, and is a snap to use.\"}),`\n`,(0,e.jsx)(l.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,e.jsx)(l.pre,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:(0,e.jsxs)(l.code,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:[(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"async\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Task \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" IActionResult \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"PostWidget\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"HttpTrigger\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"AuthorizationLevel\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Anonymous\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"post\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Route \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"widgets\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")]\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Models\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"Widget item\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" ILogger log\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"log\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"LogInformation\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'$\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"posting widget: $\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"item\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Id\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'}\"'}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"var\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" newItem \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"await\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"_dbContext\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Widgets\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"AddAsync\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"item\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"await\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"_dbContext\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"SaveChangesAsync\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"return\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"new\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" OkObjectResult\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"newItem\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Entity\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsx)(l.span,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})})]})})}),`\n`,(0,e.jsx)(l.h2,{id:\"data-envelope\",children:\"Data Envelope\"}),`\n`,(0,e.jsx)(l.p,{children:(0,e.jsx)(l.em,{children:\"This isn't required, but it is good practice. I recommend reading up on the data envelope response type for REST APIs.\"})}),`\n`,(0,e.jsx)(l.p,{children:\"Before we go any further, we are going to create a DataEnvelope response type. I prefer this type of response because it is future proof, and returns a consistent response to the client for success and failure. The best part is it allows us to return any HTTP status code with a payload. OOTB response types do not allow for this. The rest of this tutorial assumes you are using this response type.\"}),`\n`,(0,e.jsx)(l.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,e.jsx)(l.pre,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:(0,e.jsxs)(l.code,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:[(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" System.Net\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Microsoft.AspNetCore.Mvc\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"namespace\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" WidgetApi\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"Models \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"internal\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"class\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8FBCBB\"},children:\"ResponseEnvelopeResult\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" T \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">:\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" ObjectResult \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"where\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" T\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"class\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#616E88\"},children:\"/// \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"<summary>\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#616E88\"},children:\"/// Data envelope for wrapping responses\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#616E88\"},children:\"/// \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"</summary>\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#616E88\"},children:\"/// \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"<param\"}),(0,e.jsx)(l.span,{style:{color:\"#616E88\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8FBCBB\"},children:\"name\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"statusCode\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#616E88\"},children:\"http status code to return\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"</param>\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#616E88\"},children:\"/// \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"<param\"}),(0,e.jsx)(l.span,{style:{color:\"#616E88\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8FBCBB\"},children:\"name\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"data\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#616E88\"},children:\"raw response data\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"</param>\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#616E88\"},children:\"/// \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"<param\"}),(0,e.jsx)(l.span,{style:{color:\"#616E88\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8FBCBB\"},children:\"name\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"error\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#616E88\"},children:\"friendly error string\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"</param>\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"ResponseEnvelopeResult\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"HttpStatusCode statusCode \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"HttpStatusCode\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"OK\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" T data \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"null\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"object\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" error \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"null\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"):\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"base\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"new\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" ResponseEnvelope \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" T \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"data\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"error\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"))\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"this\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"StatusCode\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"int\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" statusCode\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"internal\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"class\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8FBCBB\"},children:\"ResponseEnvelope\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" T \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"where\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" T\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"class\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" T Data \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"get;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"object\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Error \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"get;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"ResponseEnvelope\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"T data\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"object\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" error\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Data\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"data\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Error\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"error\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsx)(l.span,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})})]})})}),`\n`,(0,e.jsx)(l.p,{children:\"This class also allows us to return typed responses, which is very useful if you end up using Swagger/Swashbuckle to create an OpenAPI spec for your application. OkObjectResult doesn't expose the underlying response object type, so Swagger will not be able to assert the typed model that is to be returned.\"}),`\n`,(0,e.jsx)(l.h2,{id:\"dependencies\",children:\"Dependencies\"}),`\n`,(0,e.jsx)(l.p,{children:\"All the examples here assume you are using Azure Functions V2, and\\xA0Azure Functions DI. The examples are written as though you are using Entity Framework, but they are applicable to any DB/ORM implementation.\"}),`\n`,(0,e.jsx)(l.h2,{id:\"data-models---inheritance\",children:\"Data Models - Inheritance\"}),`\n`,(0,e.jsx)(l.p,{children:\"To start out, we are going to declare a few data objects that inherit from a common abstract base class called ModelBase. The reason I am doing this is because I have audit properties that I want to appear on every data object, but I don't want to re-type it for every object. We can also leverage this base class to perform standard validation against these fields.\"}),`\n`,(0,e.jsx)(l.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,e.jsx)(l.pre,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:(0,e.jsxs)(l.code,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:[(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" System\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"namespace\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" WidgetApi\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"Models \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"abstract\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"class\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8FBCBB\"},children:\"ModelBase\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"int\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Id \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"get;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"set;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"int\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" CreatedBy \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"get;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"set;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" DateTime CreatedOn \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"get;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"set;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"int\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"?\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" UpdatedBy \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"get;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"set;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" DateTime \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"?\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" UpdatedOn \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"get;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"set;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"class\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8FBCBB\"},children:\"User\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" ModelBase \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"string\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" GivenName \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"get;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"set;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"string\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" JobTitle \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"get;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"set;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"string\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Mail \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"get;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"set;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"string\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Surname \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"get;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"set;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"class\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8FBCBB\"},children:\"Widget\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" ModelBase \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"string\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Title \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"get;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"set;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"string\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Description \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"get;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"set;\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsx)(l.span,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})})]})})}),`\n`,(0,e.jsx)(l.p,{children:\"So now we have two objects, User and Widget that exist in our code and in our imaginary database. Our goal is to make sure that when the user interacts with our REST API, they cannot perform actions that would violate our database rules.\"}),`\n`,(0,e.jsx)(l.h2,{id:\"validation-rules\",children:\"Validation Rules\"}),`\n`,(0,e.jsx)(l.p,{children:\"The next step is to use FluentValidation to create a set of rules that can be used to validate our models when they are received.\"}),`\n`,(0,e.jsx)(l.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,e.jsx)(l.pre,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:(0,e.jsxs)(l.code,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:[(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" System.Net.Http\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" FluentValidation\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" WidgetApi.Models\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"namespace\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" WidgetApi\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"FunctionHelpers \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"class\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8FBCBB\"},children:\"BaseValidator\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" T \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">:\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" AbstractValidator \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" T \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"where\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" T\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" ModelBase \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"BaseValidator\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"RuleSet\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"HttpMethod\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Post\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Method\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=>\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"RuleFor\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"x \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=>\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"x\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Id\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\").\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"Empty\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"          \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"WithMessage\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'$\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"Id field cannot be specified when POSTing a new item '\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"typeof\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"T\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\").\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Name\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"})\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"RuleSet\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"HttpMethod\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Patch\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Method\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=>\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"RuleFor\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"x \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=>\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"x\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Id\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\").\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"NotEmpty\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"})\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"RuleSet\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"audit\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=>\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"RuleFor\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"x \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=>\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"x\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"CreatedBy\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\").\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"Empty\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"RuleFor\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"x \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=>\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"x\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"CreatedOn\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\").\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"Empty\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"RuleFor\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"x \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=>\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"x\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"UpdatedBy\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\").\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"Empty\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"RuleFor\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"x \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=>\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"x\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"UpdatedOn\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\").\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"Empty\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"})\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"class\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8FBCBB\"},children:\"WidgetValidator\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" BaseValidator \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Widget \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"WidgetValidator\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"RuleSet\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"HttpMethod\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Post\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Method\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=>\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"RuleFor\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"x \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=>\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"x\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Title\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\").\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"NotEmpty\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"RuleFor\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"x \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=>\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"x\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Description\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\").\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"NotEmpty\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"})\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"class\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8FBCBB\"},children:\"UserValidator\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" BaseValidator \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" User \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{}\"})]}),`\n`,(0,e.jsx)(l.span,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})})]})})}),`\n`,(0,e.jsx)(l.p,{children:\"There is a fair bit going on in this class, so let's go over some of the important pieces. We have a few different sets of rules, some of which are only applied if a particular HttpRequest.Method is used. This allows us to do things such as force an Id to be present during an update, or enforce not having an Id on a create.\"}),`\n`,(0,e.jsx)(l.p,{children:\"In Line 7, we are declaring a new class that accepts a type T as long as the type inherits from our BaseModel class. This gives us a universal validator for every model that inherits from BaseModel. Without this, we would need to redeclare the same rules for every model that has these same properties.\"}),`\n`,(0,e.jsx)(l.p,{children:\"In Lines 11-30, we are creating a rule sets that will be used when we pass in a string that matches the HttpMethod.Post.Method, HttpMethod.Patch.Method, or audit. We do this so we can create a single rule object for all scenarios, instead of creating independent rule objects for each scenario. See the FluentValidation docs for more information on RuleSets. This will make more sense once you see the validation function.\"}),`\n`,(0,e.jsx)(l.p,{children:\"Lines 32-43 are setting up rules that will only be evaluated for Widget objects. We inherit WidgetValidator from the BaseValidator so we get the rules we already defined for free, but additionally we are remaining consistent across objects. This is extremely important for clients who will be interacting with our API. An inconsistent API is frustrating to work with, and confusing to clients.\"}),`\n`,(0,e.jsx)(l.p,{children:\"On Line 44, we creating a rules object for the User object, but don't define any additional rules for that type. If we add some later, we have a nice spot already carved out for us. We also require this empty definition in order for us to fully leverage the validator code that will be shown next.\"}),`\n`,(0,e.jsx)(l.h2,{id:\"validator-function\",children:\"Validator Function\"}),`\n`,(0,e.jsx)(l.p,{children:\"In order to maximize reusability, we are going to write a function that can validate any of our models that inherit from ModelBase.\"}),`\n`,(0,e.jsx)(l.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,e.jsx)(l.pre,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:(0,e.jsxs)(l.code,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:[(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" System\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" System.Linq\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" System.Net\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" System.Threading.Tasks\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" FluentValidation\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Microsoft.AspNetCore.Http\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Microsoft.AspNetCore.Mvc\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Microsoft.EntityFrameworkCore.Internal\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Microsoft.Extensions.Logging\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"using\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" WidgetApi.Models\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"namespace\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" WidgetApi\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"FunctionHelpers \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"class\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8FBCBB\"},children:\"FunctionWrapper\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" T \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"where\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" T\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" ModelBase \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"private\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"readonly\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" BaseValidator \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" T \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" _validator\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"private\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"readonly\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" ILogger _log\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"FunctionWrapper\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"BaseValidator \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" T \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" validator\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" ILogger \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" FunctionWrapper \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" T \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">>\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" log\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"_validator\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"validator\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"_log\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"log\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"async\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Task \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" IActionResult \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"Execute\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"T model\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" HttpRequest req\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Func \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Task \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" IActionResult \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">>\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" azureFunction\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"var\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" results \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"await\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"_validator\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"ValidateAsync\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"model\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" ruleSet\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" $ \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"default,audit,{req.Method}\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"if\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"!\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"results\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"IsValid\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"var\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" errors \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"results\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Errors\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"Select\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"x \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=>\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"x\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"ErrorMessage\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\").\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"ToList\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"_log\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"LogWarning\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'$\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"Model validation failed for type '\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"typeof\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"T\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\").\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Name\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"'. Validation errors: [\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"errors\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"Join\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()}\"}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"] \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"return\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"new\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" ResponseEnvelopeResult \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" T \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"HttpStatusCode\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"BadRequest\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"null\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"errors\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"try\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"return\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"await\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"azureFunction\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"catch\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"Exception e\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"_log\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"LogError\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"e\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"Unhandled exception occured in FunctionWrapper\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"return\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"new\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" ResponseEnvelopeResult \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" T \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"HttpStatusCode\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"InternalServerError\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"null\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"new\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"[]\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"          \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"e\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Message\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"})\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsx)(l.span,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})})]})})}),`\n`,(0,e.jsx)(l.p,{children:\"There doesn't appear to be a ton going on in this class, but that's because we have leveraged generics to do our heavy lifting. We are going to focus on the Execute method.\"}),`\n`,(0,e.jsx)(l.p,{children:\"First, we call our validator which we created earlier and will be provided to us through DI. If validation fails, we aggregate the error messages into an array and return a BadRequest with the error array in the 'errors' property of the response.\"}),`\n`,(0,e.jsxs)(l.blockquote,{children:[`\n`,(0,e.jsx)(l.p,{children:'Notice how we pass in a comma delimited string to the ruleSets argument in to the ValidateAsync method. The values in the array determine which RuleSets will be validated against. \"default\" will run all rules not in a RuleSet. \"Audit\" will run the rules in the \"audit\" RuleSet. The final argument passes the HttpRequest.Method used for the request in to validator, ensuring that we can run context specific rules against the model based on the request type.'}),`\n`]}),`\n`,(0,e.jsx)(l.p,{children:\"If validation succeeds, we will call our callback function(our original Azure function), and return those results in a data envelope. The icing on the cake is we have wrapped our callback in a try/catch block so we get consistent(again!) error responses in the case of unhandled exceptions. I focused on this particular aspect in another blog post.\"}),`\n`,(0,e.jsx)(l.h2,{id:\"wrap-it-all-up\",children:\"Wrap it all up\"}),`\n`,(0,e.jsx)(l.p,{children:\"All that is left now is to alter our original function to make use of the validator, and inject the new classes in to our DI services.\"}),`\n`,(0,e.jsx)(l.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,e.jsx)(l.pre,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:(0,e.jsxs)(l.code,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:[(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"class\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8FBCBB\"},children:\"KeyResults\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"private\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"readonly\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" WidgetDbContext _dbContext\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"private\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"readonly\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" FunctionWrapper \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Widget \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" _functionWrapper\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"Widgets\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"WidgetDbContext dbContext\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" FunctionWrapper \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Widget \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" functionWrapper\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"_dbContext\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"dbContext\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"_functionWrapper\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"functionWrapper\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"FunctionName\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"PostWidget\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")]\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"async\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Task \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" IActionResult \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"PostWidget\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"HttpTrigger\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"AuthorizationLevel\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Anonymous\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"post\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Route \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"widgets\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")]\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Widget item\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" HttpRequest req\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" ILogger log\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"return\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"await\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"_functionWrapper\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"Execute\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"req\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"item\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"async\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=>\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"log\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"LogInformation\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'$\"'}),(0,e.jsx)(l.span,{style:{color:\"#A3BE8C\"},children:\"posting widget: $\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"item\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Id\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:'}\"'}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"var\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" newItem \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"await\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"dbContext\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Widgets\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"AddAsync\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"item\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"await\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"dbContext\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"SaveChangesAsync\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"return\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"new\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" ResponseEnvelopeResult \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" Widget \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"HttpStatusCode\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Created\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"newItem\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Entity\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"})\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,e.jsx)(l.span,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})})]})})}),`\n`,(0,e.jsx)(l.p,{children:\"To update our function, we just need to inject our function wrapper in to our Function class, add the HttpRequest parameter to our function, and wrap the original function in our Execute method. The last thing is to update our startup.cs file to inject our classes.\"}),`\n`,(0,e.jsx)(l.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,e.jsx)(l.pre,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:(0,e.jsxs)(l.code,{\"data-language\":\"csharp\",\"data-theme\":\"default\",children:[(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"override\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"void\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"Configure\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"IFunctionsHostBuilder builder\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),`\n`,(0,e.jsx)(l.span,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"{\"})}),`\n`,(0,e.jsx)(l.span,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"...\"})}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"builder\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Services\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"AddLogging\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"()\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsx)(l.span,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#616E88\"},children:\"//workaround azure functions not handling nested arrays by default\"})}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"builder\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Services\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"AddTransient\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"IConfigureOptions\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"MvcOptions\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">,\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" MvcJsonMvcOptionsSetup\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">()\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"builder\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Services\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"AddTransient\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"BaseValidator\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"Widget\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">,\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" WidgetValidator\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"o \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=>\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"new\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" WidgetValidator\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"())\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"builder\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Services\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"AddTransient\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"BaseValidator\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"User\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">,\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" UserValidator\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">(\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"o \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"=>\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\"new\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\" UserValidator\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"())\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"builder\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Services\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"AddTransient\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"FunctionWrapper\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"Widget\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">>()\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"builder\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9\"},children:\"Services\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#88C0D0\"},children:\"AddTransient\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"FunctionWrapper\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"User\"}),(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\">>()\"}),(0,e.jsx)(l.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,e.jsx)(l.span,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#D8DEE9FF\"},children:\"...\"})}),`\n`,(0,e.jsx)(l.span,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#ECEFF4\"},children:\"}\"})})]})})}),`\n`,(0,e.jsxs)(l.p,{children:[\"We registered our ModelValidators and our FunctionWrapper, so everything should be good to go now. Pay attention to how we registered \",(0,e.jsx)(l.code,{children:\"BaseValidators<T>\"}),\" as service types, but used a strongly typed implementation. This is because DI needs a little help in order to find the proper validator. If you try to do this by using the named implementation, DI will fail when it attempts to find the validator in the FunctionWrapper constructor. This points it in the right direction, and lets us use a single FunctionWrapper class to create N number of FunctionWrappers. Any objects we create from now on can utilize the FunctionWrapper as long as it inherits from BaseModel!\"]}),`\n`,(0,e.jsx)(l.h2,{id:\"conclusion\",children:\"Conclusion\"}),`\n`,(0,e.jsx)(l.p,{children:\"This post turned more in to a crash course on generics, inheritance, and DI container helpers instead of validation. But by using these, we can create a model validation system for Azure Functions that is extensible, easy to maintain, and consistent(last one I promise).\"}),`\n`,(0,e.jsx)(l.p,{children:\"This concept could be expanded even further by automatically creating and injecting FunctionWrappers for any classes that implement ModelBase.\"}),`\n`,(0,e.jsx)(l.p,{children:\"In closing, the following is a summary of program flow when a request hits this function.\"}),`\n`,(0,e.jsxs)(l.ul,{children:[`\n`,(0,e.jsx)(l.li,{children:\"Request hits function\"}),`\n`,(0,e.jsxs)(l.li,{children:[\"FunctionWrapper.Execute is called\",`\n`,(0,e.jsxs)(l.ul,{children:[`\n`,(0,e.jsx)(l.li,{children:\"User request object, original HttpRequest, and callback are passed in\"}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(l.li,{children:[\"Validation runs\",`\n`,(0,e.jsxs)(l.ul,{children:[`\n`,(0,e.jsxs)(l.li,{children:[\"BaseValidator rules are run\",`\n`,(0,e.jsxs)(l.ul,{children:[`\n`,(0,e.jsx)(l.li,{children:\"Some rules are run based on HttpRequest.Method\"}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(l.li,{children:[\"Specific type T validation is run\",`\n`,(0,e.jsxs)(l.ul,{children:[`\n`,(0,e.jsx)(l.li,{children:\"Some rules are run based on HttpRequest.Method\"}),`\n`]}),`\n`]}),`\n`,(0,e.jsx)(l.li,{children:\"If validation fails, all errors are aggregated and returned in the response\"}),`\n`]}),`\n`]}),`\n`,(0,e.jsx)(l.li,{children:\"The original function code is run and a success response is returned.\"}),`\n`]})]})}function g(n={}){let{wrapper:l}=n.components||{};return l?(0,e.jsx)(l,Object.assign({},n,{children:(0,e.jsx)(d,n)})):d(n)}var N=g;return m(f);})();\n;return Component;"
  },
  {
    "filepath": "content\\posts\\2021\\aws-ecs-fargate-bastion-host.md",
    "url": "posts/2021/aws-ecs-fargate-bastion-host",
    "year": 2021,
    "slug": "aws-ecs-fargate-bastion-host",
    "hash": "cN3Bf/Nx7z0Y4XOvWsmTY1koBz8=",
    "pageContent": "var Component=(()=>{var d=Object.create;var o=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var y=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty;var D=(l,e)=>()=>(e||l((e={exports:{}}).exports,e),e.exports),u=(l,e)=>{for(var s in e)o(l,s,{get:e[s],enumerable:!0})},c=(l,e,s,a)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let r of E(e))!F.call(l,r)&&r!==s&&o(l,r,{get:()=>e[r],enumerable:!(a=p(e,r))||a.enumerable});return l};var m=(l,e,s)=>(s=l!=null?d(y(l)):{},c(e||!l||!l.__esModule?o(s,\"default\",{value:l,enumerable:!0}):s,l)),g=l=>c(o({},\"__esModule\",{value:!0}),l);var t=D((A,i)=>{i.exports=_jsx_runtime});var f={};u(f,{default:()=>w,frontmatter:()=>C});var n=m(t()),C={title:\"AWS ECS/Fargate Bastion Host\",metaDesc:\"An elaborate experiment to see how viable using ECS/Fargate for a persistent bastion host really is\",headerImage:\"/assets/posts/2021/aws-ecs-fargate-bastion-host-1.webp\",date:new Date(16146432e5),tags:[\"aws\",\"docker\"]};function h(l){let e=Object.assign({h1:\"h1\",p:\"p\",a:\"a\",h2:\"h2\",img:\"img\",ul:\"ul\",li:\"li\",div:\"div\",pre:\"pre\",code:\"code\",span:\"span\"},l.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.h1,{id:\"aws-ecsfargate-bastion-host\",children:\"AWS ECS/Fargate Bastion Host\"}),`\n`,(0,n.jsx)(e.p,{children:\"AWS Fargate is a great tool for quickly putting together scalable infrastructure. The ability to spin containers up and down based on usage, as well as failure-recovery has created a bunch of new opportunities for HA services, but without the administrative headache that typically comes along with them.\"}),`\n`,(0,n.jsx)(e.p,{children:\"In this post, I\\u2019ll walk through a set of Terraform templates that will deploy HA load-balanced bastion servers in to AWS Fargate. These servers can be used for basic SSH access, or more conveniently, SSH tunneling to reach otherwise inaccessible pieces of infrastructure hidden in private subnets.\"}),`\n`,(0,n.jsx)(e.p,{children:\"TL;DR\"}),`\n`,(0,n.jsxs)(e.p,{children:[`The complete repository can be found here:\n`,(0,n.jsx)(e.a,{href:\"https://github.com/bruceharrison1984/aws-fargate-bastion-cluster\",children:\"https://github.com/bruceharrison1984/aws-fargate-bastion-cluster\"})]}),`\n`,(0,n.jsx)(e.h2,{id:\"architecture\",children:\"Architecture\"}),`\n`,(0,n.jsx)(e.p,{children:\"The general architecture is represented in the following diagram:\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/posts/2021/aws-ecs-fargate-bastion-host-1.webp\",alt:\"Image1\",width:\"1024\",height:\"804\"})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Matching private/public subnets in each AZ\"}),`\n`,(0,n.jsxs)(e.li,{children:[\"Three ECS Fargate containers running the linuxserver/openssh-server container\",`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Containers are deployed in to each subnet by ECS\"}),`\n`]}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[\"A single NLB, with endpoints in each of the public subnets\",`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"The bastion ECS tasks can communicate with any of the NLB endpoints (not depicted in the diagram)\"}),`\n`]}),`\n`]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"So we have a highly resilient architecture in terms of network failure, and it is presented to the internet as a single endpoint. Nice!\"}),`\n`,(0,n.jsx)(e.h2,{id:\"why-not-application-load-balancer\",children:\"Why Not Application Load Balancer?\"}),`\n`,(0,n.jsx)(e.p,{children:\"Initially I had wanted to use an ALB, but there is a big drawback to ALBs. They can only forward communications to applications that serve HTTP/HTTPs content. They aren\\u2019t able to pass generic TCP communications(SSH) to backend services, so thus it doesn\\u2019t work in this scenario. So the NLB allows us to do what we need, but it has a major drawback I will highlight shortly.\"}),`\n`,(0,n.jsx)(e.p,{children:\"The upside to the NLB, is that it is a layer 4 service, so it is extremely fast and doesn\\u2019t add much overhead to the TCP communication.\"}),`\n`,(0,n.jsx)(e.h2,{id:\"authentication\",children:\"Authentication\"}),`\n`,(0,n.jsx)(e.p,{children:\"We will handle authentication in to our SSH server with certificates. Our container conveniently disables username/password login, so we can feel fairly safe from brute force attacks. We will leverage a couple Terraform modules to get our authentication setup:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"Use the Terraform TLS provider to generate a 2048 bit certificate\",`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Place the public/private keys in to AWS Secrets Manager\"}),`\n`]}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Use the Terraform random provider to generate a random username\",`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Place this in to AWS Secrets Manager\"}),`\n`]}),`\n`]}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"So now we have everything we need to get secure login, but now we need our container to know about it. The next step is to allow the ECS Task to access those particular Secrets and read them, and inject the values as environment variables in to our container. The \",(0,n.jsx)(e.a,{href:\"https://github.com/linuxserver/docker-openssh-server\",children:\"linuxserver/openssh-server\"}),\" does most of the heavy lifting here, so kudos to the developers of it.\"]}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"hcl\",\"data-theme\":\"default\",children:(0,n.jsxs)(e.code,{\"data-language\":\"hcl\",\"data-theme\":\"default\",children:[(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"resource \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:'\"aws_ecs_task_definition\"'}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:'\"bastion\"'}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"family\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                   \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"${\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"var\"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"base_name\"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"}\"}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"-bastion-task\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"network_mode\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"             \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"awsvpc\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"requires_compatibilities\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"FARGATE\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"cpu\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                      \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#B48EAD\"},children:\"256\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"memory\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                   \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#B48EAD\"},children:\"512\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"execution_role_arn\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"       \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" aws_iam_role\"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"ecs_task_execution_role\"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"arn\"})]}),`\n`,(0,n.jsx)(e.span,{className:\"line\"}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"container_definitions\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"jsonencode\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"([{\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"name\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"bastion\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"image\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"     \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"linuxserver/openssh-server\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"essential\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"true\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"portMappings\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" [\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"protocol\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"tcp\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"containerPort\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#B48EAD\"},children:\"2222\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"hostPort\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#B48EAD\"},children:\"2222\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"]\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"environment\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" [\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"name\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"DOCKER_MODS\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"value\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"linuxserver/mods:openssh-server-ssh-tunnel\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#616E88\"},children:\"## enable ssh-tunneling to backend resources\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    ]\"})}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"secrets\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" [\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"name\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"PUBLIC_KEY\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#616E88\"},children:\"## inject public key in to container\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"valueFrom\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" var.public_key_secret_arn\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\",\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"name\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"USER_NAME\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#616E88\"},children:\"## inject bastion username in to container\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"valueFrom\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" var.bastion_username\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\",\"})]}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    ]\"})}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"logConfiguration\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"logDriver\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"awslogs\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"options\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"awslogs-group\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"         \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" aws_cloudwatch_log_group.bastion.name\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"awslogs-stream-prefix\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"ecs\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"awslogs-region\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"us-east-2\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}])\"})]}),`\n`,(0,n.jsx)(e.span,{className:\"line\"}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"tags\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"merge\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"var\"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"default_tags\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Name\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"${\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"var\"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"base_name\"}),(0,n.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"}\"}),(0,n.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"-bastion-task\"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"})\"})]}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})})]})})}),`\n`,(0,n.jsx)(e.p,{children:\"The parts to focus on on the \\u201Csecrets\\u201D and \\u201Cenvironment\\u201D sections of the task configuration. We pipe in the ARNs of the username and public keys so they are available within the container. The extra little piece of magic is the DOCKER_MODS environment variable that the linuxserver team makes use of. It allows us to enable SSH Tunneling without re-rolling the image (good job guys!).\"}),`\n`,(0,n.jsx)(e.p,{children:\"When the container starts up, it will place the public key in the authorized_keys, and create a user based on the username Terraform created.\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/posts/2021/aws-ecs-fargate-bastion-host-2.png\",alt:\"Image1\",width:\"990\",height:\"195\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Now we can login to the server by doing the following:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Retrieve the username from AWS Secrets Manager\"}),`\n`,(0,n.jsxs)(e.li,{children:[\"Retrieve the private key from AWS Secrets Manager\",`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"The contents of the secret must be written to a file where your SSH client can access it (~/.ssh/ etc)\"}),`\n`]}),`\n`]}),`\n`,(0,n.jsx)(e.li,{children:\"Open an SSH connection to the bastion_ssh_endpoint, using the certificate as the identity, and entering the username when you are prompted.\"}),`\n`]}),`\n`,(0,n.jsx)(e.h2,{id:\"upsides\",children:\"Upsides\"}),`\n`,(0,n.jsx)(e.p,{children:\"We have a bastion host that we can very reliably presume will always be available, and it\\u2019s (kinda) cost effective. By using a secured container, we can also be sure that SSH users can\\u2019t escape their sandbox and cause issues on the SSH server itself.\"}),`\n`,(0,n.jsx)(e.h2,{id:\"caveats-uh-oh\",children:\"Caveats (uh oh...)\"}),`\n`,(0,n.jsx)(e.p,{children:\"While deploying your bastion hosts in an ephemeral and scalable fashion, it does have some significant drawbacks.\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"Network Load Balancers cannot be protected with Security Groups\",`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"This means your bastion hosts are discoverable by anyone on the internet.\",`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"They are still protected by certificate authentication\"}),`\n`]}),`\n`]}),`\n`,(0,n.jsx)(e.li,{children:\"The Network Load Balancer must be whitelisted to the ECS container security group for the sake of health-checks as well as SSH traffic (which in turn allows all traffic). So there isn\\u2019t a way around this.\"}),`\n`]}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[\"You cannot guarantee which bastion host you will hit when logging in, so SSH Fingerprint errors are likely to occur when logging in.\",`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"This could be extremely annoying if you intend to interact with these servers in an automated fashion\"}),`\n`,(0,n.jsx)(e.li,{children:\"Opens the door to potential MITM attacks if you just ignore the errors\"}),`\n`]}),`\n`]}),`\n`]}),`\n`,(0,n.jsx)(e.h2,{id:\"alternatives\",children:\"Alternatives\"}),`\n`,(0,n.jsx)(e.p,{children:\"Something as simple as a standard EC2 secured by Security groups has worked great in the past, and continues to do so. You could also host a single Fargate container behind a Security group as well. These are both very simple scenarios, and a large organization will likely have much greater needs than any of these configurations can realistically provide. But for small projects and startups, this should be more than enough to fill the need for the short-term.\"}),`\n`,(0,n.jsx)(e.h2,{id:\"final-thoughts\",children:\"Final Thoughts\"}),`\n`,(0,n.jsx)(e.p,{children:\"I had a fun time thinking through this process, and coming up with an architecture that would let me deploy bastion servers in this way. Sadly, the serious caveats will likely outweigh any benefits, so I would be apprehensive about deploying this in a production environment. The inability to shield the bastion containers from direct internet access leaves a bad taste in my mouth, and I would sooner deploy a single EC2 instance and deal with occasional reboots.\"}),`\n`,(0,n.jsxs)(e.p,{children:[`The complete repository can be found here:\n`,(0,n.jsx)(e.a,{href:\"https://github.com/bruceharrison1984/aws-fargate-bastion-cluster\",children:\"https://github.com/bruceharrison1984/aws-fargate-bastion-cluster\"})]}),`\n`,(0,n.jsx)(e.h2,{id:\"even-more-final-thoughts\",children:\"Even more final thoughts\"}),`\n`,(0,n.jsx)(e.p,{children:\"If you are determined to go down this road, I would recommend just using a single FarGate container exposed to the internet, secured with an SSH key and IP whitelisting.\"}),`\n`,(0,n.jsx)(e.p,{children:\"The accompanying repository can be setup to do this by simply changing module.bastion.container_count = 1 instead of 3. This avoids the SSL thumbprint issue, so you can securely connect to the container.\"}),`\n`,(0,n.jsx)(e.p,{children:\"However, at that point the NLB is basically pointless and could be removed. With the NLB gone, you would be free to secure the server with IP whitelisting via Security Groups, which is a much better solution.\"})]})}function b(l={}){let{wrapper:e}=l.components||{};return e?(0,n.jsx)(e,Object.assign({},l,{children:(0,n.jsx)(h,l)})):h(l)}var w=b;return g(f);})();\n;return Component;"
  },
  {
    "filepath": "content\\posts\\2021\\aws-secrets-manager-terraform.md",
    "url": "posts/2021/aws-secrets-manager-terraform",
    "year": 2021,
    "slug": "aws-secrets-manager-terraform",
    "hash": "LYjVv3VdTgLs9HtKgMBnG+V5GDM=",
    "pageContent": "var Component=(()=>{var d=Object.create;var c=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var y=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty;var F=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),m=(s,e)=>{for(var n in e)c(s,n,{get:e[n],enumerable:!0})},o=(s,e,n,a)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let r of h(e))!D.call(s,r)&&r!==n&&c(s,r,{get:()=>e[r],enumerable:!(a=p(e,r))||a.enumerable});return s};var C=(s,e,n)=>(n=s!=null?d(y(s)):{},o(e||!s||!s.__esModule?c(n,\"default\",{value:s,enumerable:!0}):n,s)),u=s=>o(c({},\"__esModule\",{value:!0}),s);var i=F((b,t)=>{t.exports=_jsx_runtime});var N={};m(N,{default:()=>g,frontmatter:()=>A});var l=C(i()),A={title:\"AWS Secrets Manager & Terraform\",metaDesc:\"How to use the AWS Terraform provider to store secrets in AWS Secret Manager\",headerImage:\"/assets/posts/2021/aws-secrets-manager-terraform-1.png\",date:new Date(16146432e5),tags:[\"aws\",\"terraform\"]};function E(s){let e=Object.assign({h1:\"h1\",p:\"p\",div:\"div\",pre:\"pre\",code:\"code\",span:\"span\",img:\"img\",a:\"a\"},s.components);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.h1,{id:\"aws-secrets-manager--terraform\",children:\"AWS Secrets Manager & Terraform\"}),`\n`,(0,l.jsx)(e.p,{children:\"I addition of AWS Secrets Manager has been a great help with Terraform deployments in to AWS. Previously, SSM Parameter Store could be used, but it lacked any security features. Secrets Manager rectifies this, and it has first-class Terraform support.\"}),`\n`,(0,l.jsx)(e.p,{children:\"There are countless patterns you can use within Terraform to put values in to AWS Secrets Manager, but I have found the following module to be convenient and easy was to do it. It centralizes all the secret management, and makes it easy to name them all consistently. The output also makes it easy for other Terraform templates that utilize remote-state to access the same secrets.\"}),`\n`,(0,l.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,l.jsx)(e.pre,{\"data-language\":\"hcl\",\"data-theme\":\"default\",children:(0,l.jsxs)(e.code,{\"data-language\":\"hcl\",\"data-theme\":\"default\",children:[(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"variable \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:'\"base_name\"'}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"description\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"The prefix on created resources\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"variable \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:'\"secret_map\"'}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"description\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"A Key/Value map of secrets that will be added to AWS Secrets\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"type\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"string\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"variable \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:'\"default_tags\"'}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"description\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Tags to be applied to resources\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"variable \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:'\"secret_retention_days\"'}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"default\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"     \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#B48EAD\"},children:\"0\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"description\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Number of days before secret is actually deleted. Increasing this above 0 will result in Terraform errors if you redeploy to the same workspace.\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"resource \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:'\"aws_secretsmanager_secret\"'}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:'\"map_secret\"'}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"for_each\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" var\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"secret_map\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"name\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                    \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"/\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"${\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"terraform\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"workspace\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"/\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"${\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"each\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"key\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"recovery_window_in_days\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" var\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"secret_retention_days\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"tags\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"merge\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"var\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"default_tags\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Name\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"${\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"var\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"base_name\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"\\u2013\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"${\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"each\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"key\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"})\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"resource \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:'\"aws_secretsmanager_secret_version\"'}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:'\"map_secret\"'}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"for_each\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" aws_secretsmanager_secret\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"map_secret\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"secret_id\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"     \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" aws_secretsmanager_secret\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"map_secret\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"each\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"key\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"]\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"id\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"secret_string\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" var\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"secret_map\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"each\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"key\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"output \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:'\"secret_arns\"'}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"value\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"zipmap\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"keys\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"aws_secretsmanager_secret_version\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"map_secret\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"),\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"values\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"aws_secretsmanager_secret_version\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"map_secret\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")[\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"*\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"]\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"arn\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\"})]})})}),`\n`,(0,l.jsx)(e.p,{children:\"Usage is extremely straight-forward:\"}),`\n`,(0,l.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,l.jsx)(e.pre,{\"data-language\":\"hcl\",\"data-theme\":\"default\",children:(0,l.jsxs)(e.code,{\"data-language\":\"hcl\",\"data-theme\":\"default\",children:[(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"module \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:'\"secrets\"'}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"source\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"       \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"./secrets\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"base_name\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" local\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"base_name\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"default_tags\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" local\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"default_tags\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"secret_map\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"shared/bastion/ssh/public_pem\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"         = tls_private_key.bastion.public_key_openssh\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"shared/bastion/ssh/private_pem\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        = tls_private_key.bastion.private_key_pem\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"shared/bastion/ssh/username\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"           = random_pet.bastion_username.id\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})})]})})}),`\n`,(0,l.jsx)(e.p,{children:\"The output of the module is a map of secret-name/secret-arn, which can be easily passed to other processes so they can securely retrieve the values, without exposing them.\"}),`\n`,(0,l.jsx)(e.p,{children:(0,l.jsx)(e.img,{src:\"/assets/posts/2021/aws-secrets-manager-terraform-1.png\",alt:\"Image1\",width:\"974\",height:\"165\"})}),`\n`,(0,l.jsxs)(e.p,{children:[`A more complete example can be found in this repository:\n`,(0,l.jsx)(e.a,{href:\"https://github.com/bruceharrison1984/aws-fargate-bastion-cluster/tree/dev/secrets\",children:\"https://github.com/bruceharrison1984/aws-fargate-bastion-cluster/tree/dev/secrets\"})]})]})}function _(s={}){let{wrapper:e}=s.components||{};return e?(0,l.jsx)(e,Object.assign({},s,{children:(0,l.jsx)(E,s)})):E(s)}var g=_;return u(N);})();\n;return Component;"
  },
  {
    "filepath": "content\\posts\\2021\\exporting-prometheus-metrics-from-ecs-fargate-in-to-amp.md",
    "url": "posts/2021/exporting-prometheus-metrics-from-ecs-fargate-in-to-amp",
    "year": 2021,
    "slug": "exporting-prometheus-metrics-from-ecs-fargate-in-to-amp",
    "hash": "KP4nXHxq0DE9IhBWuyc2xFeAoq8=",
    "pageContent": "var Component=(()=>{var E=Object.create;var o=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty;var C=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),m=(n,e)=>{for(var s in e)o(n,s,{get:e[s],enumerable:!0})},a=(n,e,s,c)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let r of d(e))!y.call(n,r)&&r!==s&&o(n,r,{get:()=>e[r],enumerable:!(c=F(e,r))||c.enumerable});return n};var D=(n,e,s)=>(s=n!=null?E(p(n)):{},a(e||!n||!n.__esModule?o(s,\"default\",{value:n,enumerable:!0}):s,n)),u=n=>a(o({},\"__esModule\",{value:!0}),n);var t=C((A,i)=>{i.exports=_jsx_runtime});var w={};m(w,{default:()=>f,frontmatter:()=>B});var l=D(t()),B={title:\"Exporting Prometheus Metrics from ECS Fargate in to AMP\",metaDesc:\"Getting AWS Prometheus and ECS Fargate communicating for metric gathering of containerized processes\",date:new Date(16293312e5),tags:[\"aws\",\"prometheus\",\"ecs\"]};function h(n){let e=Object.assign({h1:\"h1\",p:\"p\",h2:\"h2\",ul:\"ul\",li:\"li\",a:\"a\",h3:\"h3\",div:\"div\",pre:\"pre\",code:\"code\",span:\"span\"},n.components);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.h1,{id:\"exporting-prometheus-metrics-from-ecs-fargate-in-to-amp\",children:\"Exporting Prometheus Metrics from ECS Fargate in to AMP\"}),`\n`,(0,l.jsx)(e.p,{children:\"My latest project had us deploying a large number of containerized workloads in to Amazon ECS Fargate. These applications are built on a RabbitMQ service bus architecture, so monitoring of the workloads that are pulling from queues was extremely important. We decided to go with Prometheus as our instrumentation/metrics layer due to it\\u2019s current popularity, as well as it\\u2019s general simplicity.\"}),`\n`,(0,l.jsx)(e.p,{children:\"Amazon also just released their Amazon Managed Prometheus(AMP) in to public beta, so we figured why not give that a shot as well. It\\u2019s always good news when you can get someone else to take care of the application box right?\"}),`\n`,(0,l.jsx)(e.p,{children:\"The first half of this post will an explanation of the problem and solution, with the technical explanation at the second half. If you just want to know how to make it work, skip ahead to the second half.\"}),`\n`,(0,l.jsx)(e.h2,{id:\"the-requirements\",children:\"The Requirements\"}),`\n`,(0,l.jsx)(e.p,{children:\"The problem itself was pretty straight-forward:\"}),`\n`,(0,l.jsxs)(e.ul,{children:[`\n`,(0,l.jsx)(e.li,{children:\"(n) number of containerized workloads\"}),`\n`,(0,l.jsx)(e.li,{children:\"These will dynamically scale up and down based on certain metric thresholds\"}),`\n`,(0,l.jsx)(e.li,{children:\"All containers hosted out of ECS Fargate in a single cluster\"}),`\n`,(0,l.jsx)(e.li,{children:\"Containers are in private subnets\"}),`\n`,(0,l.jsx)(e.li,{children:\"Prometheus endpoints will be expected to be available on all containers\"}),`\n`,(0,l.jsx)(e.li,{children:\"Prometheus metrics should be stored in AMP\"}),`\n`]}),`\n`,(0,l.jsx)(e.h2,{id:\"existing-information\",children:\"Existing Information\"}),`\n`,(0,l.jsx)(e.p,{children:\"The following two posts were what I initially found when I started looking for solutions to this problem:\"}),`\n`,(0,l.jsxs)(e.ul,{children:[`\n`,(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:\"https://aws.amazon.com/blogs/opensource/metrics-collection-from-amazon-ecs-using-amazon-managed-service-for-prometheus/\",children:\"https://aws.amazon.com/blogs/opensource/metrics-collection-from-amazon-ecs-using-amazon-managed-service-for-prometheus/\"})}),`\n`,(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:\"https://tomgregory.com/prometheus-service-discovery-for-aws-ecs/\",children:\"https://tomgregory.com/prometheus-service-discovery-for-aws-ecs/\"})}),`\n`]}),`\n`,(0,l.jsx)(e.p,{children:\"Both contain similar approaches, as well as a wealth of good information. The downside to them, however, is they both apply to ECS on EC2, and not Fargate. Both of these solutions rely on 3 containers to scrape Prometheus metrics from ECS and send them to a Prometheus server. Their overall strategy was solid, but it needed a bit more magic dust to bring it together in Fargate. Merging both solutions together, you can come up with the following process flow:\"}),`\n`,(0,l.jsxs)(e.ul,{children:[`\n`,(0,l.jsx)(e.li,{children:\"One container is used to scan the ECS cluster and look for tasks with particular Docker labels. This container then generates a Prometheus scrape configuration. The generated scrape configuration is written to a shared Docker volume\"}),`\n`,(0,l.jsx)(e.li,{children:\"A Prometheus container reads the generated scrape configuration from the shared Docker volume, and goes and scrapes those targets.\"}),`\n`,(0,l.jsx)(e.li,{children:\"The Prometheus container is setup to use remote_write, which sends logs to the third container, which signs the requests with AWS SigV4 signature, and passes them to AMP.\"}),`\n`]}),`\n`,(0,l.jsx)(e.h2,{id:\"the-solution\",children:\"The Solution\"}),`\n`,(0,l.jsx)(e.p,{children:\"While the existing information I found was invaluable to solving my problem, I took a slightly different angle which I think yielded an overall simpler solution. I\\u2019ll split these up in to smaller sections.\"}),`\n`,(0,l.jsx)(e.h3,{id:\"prometheus-container\",children:\"Prometheus Container\"}),`\n`,(0,l.jsx)(e.p,{children:\"I ended up rolling a custom Prometheus container that could fetch its configuration data from an S3 bucket upon startup. I found similar containers but they all fetched from public endpoints, which is a little smelly to me. I made some simple changes to tkgregory/prometheus-with-remote-configuration, updated the Prometheus version and altered it fetch config from S3. My version of this container can be found at bruceharrison1984/docker-prometheus-s3. The container itself can be pulled and used from GitHub as well. The rest of this post assumes you are using my container(or at least one higher than 2.26.0).\"}),`\n`,(0,l.jsx)(e.p,{children:\"The bigger part was updating the container to be based on a version of Prometheus after 2.26.0, which has AWS SigV4 support built-in. This allows us to completely remove the SigV4 container from the process.\"}),`\n`,(0,l.jsx)(e.h3,{id:\"ecs-scanning\",children:\"ECS Scanning\"}),`\n`,(0,l.jsx)(e.p,{children:\"The ECS Scanning method used by both posts is perfectly valid, and it works perfectly. I saw no reason to mess with success, and I used exactly the same method they used to generate a scrape config for Prometheus. I used the tkgregory/prometheus-ecs-discovery container.\"}),`\n`,(0,l.jsx)(e.h3,{id:\"aws-sigv4-container\",children:\"AWS Sigv4 Container\"}),`\n`,(0,l.jsx)(e.p,{children:\"In a great stroke of luck, Prometheus now has native support for AWS SigV4 request signing. This means a side-car container is no longer needed, and you can directly forward Prometheus metrics to AMP by using remote_write. This functionality was added in Prometheus 2.26.0.\"}),`\n`,(0,l.jsx)(e.p,{children:\"So in the end, our solution will have a single ECS Fargate Task, that is running two containers, and forwarding metrics directly in to AMP.\"}),`\n`,(0,l.jsx)(e.p,{children:\"That about sums about the thought process I went through when coming up with a way to do this. The rest of the post will specifically be the technical aspects of how to do this.\"}),`\n`,(0,l.jsx)(e.h2,{id:\"technical-explanation\",children:\"Technical Explanation\"}),`\n`,(0,l.jsx)(e.p,{children:\"If you made it this far, you\\u2019re looking for how to make this actually work, and not the theory behind it. The following will be configuration values with brief explanations. I presume you already know what to do with these items, and how to modify them to fit your environment. These configuration values are in no way intended to be copy/pasted since they all have fields that must be set according to your own AWS environment.\"}),`\n`,(0,l.jsx)(e.p,{children:\"You may notice that the ECS Execution policy is missing. In most cases it only contains the CloudWatchAgentServerPolicy and that is all. If you are using a custom Prometheus image in a private registry, your policy will also require access to AWS Secret Manager in order to retrieve credentials to your private registry. (Private Registry Documentation)\"}),`\n`,(0,l.jsx)(e.p,{children:\"I also presume you already have setup Security Groups that will allow one task to query the Prometheus endpoint of another task, and your networking configuration allow this. If your scrapes are failing, check that you have network connectivity between tasks.\"}),`\n`,(0,l.jsx)(e.h3,{id:\"ecs-task-definitions\",children:\"ECS Task Definitions\"}),`\n`,(0,l.jsx)(e.p,{children:\"This task definition will create two containers, with a volume shared between them. The first container is in charge of scanning ECS and finding containers with the PROMETHEUS_EXPORTER_PORT Docker label. The ECS scanning container will then write /output/ecs_file_sd.yml to the shared volume, which is then accessed by the second Prometheus container.\"}),`\n`,(0,l.jsx)(e.p,{children:\"The second container is a custom Prometheus container. It fetches it\\u2019s configuration from an S3 bucket, and then proceeds to scrape any ECS containers container within the /output/ecs_file_sd.yml. These metrics are then forwarded to AMP.\"}),`\n`,(0,l.jsx)(e.p,{children:\"My S3 Prometheus container is used in this example, and it is publicly available if you choose to use it.\"}),`\n`,(0,l.jsx)(e.p,{children:\"Things such as log groups, regions, and the s3 bucket will need to be setup according to your own environment.\"}),`\n`,(0,l.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,l.jsx)(e.pre,{\"data-language\":\"json\",\"data-theme\":\"default\",children:(0,l.jsxs)(e.code,{\"data-language\":\"json\",\"data-theme\":\"default\",children:[(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"executionRoleArn\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"<execution-role-arn>\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"containerDefinitions\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"image\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"tkgregory/prometheus-ecs-discovery:latest\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"name\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"prometheus-ecs-discovery-alpha\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"logConfiguration\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"logDriver\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"awslogs\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"options\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"awslogs-group\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"/ecs/alpha/ecs-prometheus\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"awslogs-region\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"us-east-1\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"awslogs-stream-prefix\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"prometheus-ecs-discovery\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"},\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"command\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"-config.cluster=<cluster-name>\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"-config.write-to=/output/ecs_file_sd.yml\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"],\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"mountPoints\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"containerPath\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"/output\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"sourceVolume\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"ecs-discovery\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"},\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"image\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"ghcr.io/bruceharrison1984/ecomm-prometheus:v2.29.1\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"name\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"prometheus-alpha\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"logConfiguration\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"logDriver\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"awslogs\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"options\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"awslogs-group\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"/ecs/alpha/ecs-prometheus\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"awslogs-region\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"us-east-1\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"awslogs-stream-prefix\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"prometheus\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"},\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"environment\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"name\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"S3_CONFIG_LOCATION\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"value\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"s3://<s3-bucket>/prometheus.yml\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"],\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"mountPoints\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"containerPath\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"/output\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"sourceVolume\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"ecs-discovery\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"],\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"memory\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"2048\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"taskRoleArn\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"<task-role-arn>\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"compatibilities\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"EC2\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"FARGATE\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"],\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"requiresCompatibilities\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"FARGATE\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"],\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"networkMode\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"awsvpc\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"cpu\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"1024\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"status\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"ACTIVE\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"volumes\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"name\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"ecs-discovery\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})})]})})}),`\n`,(0,l.jsx)(e.h3,{id:\"ecs-task-iam-policy\",children:\"ECS Task IAM Policy\"}),`\n`,(0,l.jsx)(e.p,{children:\"The following policy should be applied to the ECS Task Role that is running the containers. It grants the follow permissions to the containers. I\\u2019ve paired the containers with the permissions that they will be using:\"}),`\n`,(0,l.jsxs)(e.ul,{children:[`\n`,(0,l.jsxs)(e.li,{children:[\"ECS Scanner container\",`\n`,(0,l.jsxs)(e.ul,{children:[`\n`,(0,l.jsx)(e.li,{children:\"Ability to scan ECS clusters and Tasks in order to generate the config file\"}),`\n`]}),`\n`]}),`\n`,(0,l.jsxs)(e.li,{children:[\"Prometheus Container\",`\n`,(0,l.jsxs)(e.ul,{children:[`\n`,(0,l.jsx)(e.li,{children:\"Ability to read from an S3 bucket to fetch it\\u2019s configuration\"}),`\n`,(0,l.jsx)(e.li,{children:\"Ability to write to AMP\"}),`\n`]}),`\n`]}),`\n`]}),`\n`,(0,l.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,l.jsx)(e.pre,{\"data-language\":\"json\",\"data-theme\":\"default\",children:(0,l.jsxs)(e.code,{\"data-language\":\"json\",\"data-theme\":\"default\",children:[(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"Statement\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"Action\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"ecs:List*\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"ecs:Describe*\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"],\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"Effect\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Allow\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"Resource\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"arn:aws:ecs:<region>:<account-id>:cluster/<ecs-cluster-name>\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"arn:aws:ecs:<region>:<account-id>:task/<ecs-cluster-name>/*\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"},\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"Action\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"ecs:ListTasks\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"ecs:DescribeTaskDefinition\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"],\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"Effect\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Allow\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"Resource\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"*\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"},\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"Action\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"s3:GetObject\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"s3:ListBucket\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"],\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"Effect\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Allow\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"Resource\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"arn:aws:s3:::<s3-bucket-name>\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"arn:aws:s3:::<s3-bucket-name>/*\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"},\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"Action\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"aps:RemoteWrite\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"],\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"Effect\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Allow\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"Resource\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"<AMP-resource-arn>\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"],\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"Version\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"2012-10-17\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})})]})})}),`\n`,(0,l.jsx)(e.h3,{id:\"prometheus-config\",children:\"Prometheus Config\"}),`\n`,(0,l.jsx)(e.p,{children:\"This configuration file tells Prometheus where to find it\\u2019s list of scrape targets(the shared volume), as well as the remote endpoint it should write to. SigV4 is the magic part that allows us to totally skip the side-car container. This file should be placed in to an S3 bucket, and the path placed in to the Task Role IAM policy in the correct location.\"}),`\n`,(0,l.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,l.jsx)(e.pre,{\"data-language\":\"yaml\",\"data-theme\":\"default\",children:(0,l.jsxs)(e.code,{\"data-language\":\"yaml\",\"data-theme\":\"default\",children:[(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"global\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"evaluation_interval\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"1m\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"scrape_interval\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"30s\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"scrape_timeout\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"10s\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"remote_write\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"\\u2013 url\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"<amp-endpoint>api/v1/remote_write\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"sigv4\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"region\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"<aws-region>\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"scrape_configs\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"\\u2013 job_name\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"ecs\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"file_sd_configs\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"\\u2013 files\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"\\u2013 /output/ecs_file_sd.yml\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"refresh_interval\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"1m\"})]})]})})}),`\n`,(0,l.jsx)(e.h2,{id:\"summary\",children:\"Summary\"}),`\n`,(0,l.jsx)(e.p,{children:\"Using the above methodology, I was able to implement a fairly simple solution for getting Prometheus metrics out of ECS Fargate, and into AMP. The ability to use Docker labels to add/remove scanned tasks means maintenance shouldn\\u2019t be a large issue going forward, because it\\u2019s simple to add new tasks as they are created. This also applies to auto-scaling containers as well, so we can be sure we won\\u2019t lose valuable metrics as ephemeral containers pop in and out of existence.\"}),`\n`,(0,l.jsx)(e.p,{children:\"It wouldn\\u2019t be a stretch to use the same task instance to query multiple ECS clusters either. As long as you have sufficient IAM permissions and network connectivity, the very same task could be used to forward metrics in multiple ECS clusters. Beware CPU/memory constraints on the Prometheus task though!\"})]})}function g(n={}){let{wrapper:e}=n.components||{};return e?(0,l.jsx)(e,Object.assign({},n,{children:(0,l.jsx)(h,n)})):h(n)}var f=g;return u(w);})();\n;return Component;"
  },
  {
    "filepath": "content\\posts\\2021\\monitor-headless-worker-services-in-net-core-5-0.md",
    "url": "posts/2021/monitor-headless-worker-services-in-net-core-5-0",
    "year": 2021,
    "slug": "monitor-headless-worker-services-in-net-core-5-0",
    "hash": "f/wpfuTkV877Bh8K8kWVh32+Z6o=",
    "pageContent": "var Component=(()=>{var d=Object.create;var c=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var F=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty;var D=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),C=(n,e)=>{for(var s in e)c(n,s,{get:e[s],enumerable:!0})},a=(n,e,s,o)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let r of p(e))!y.call(n,r)&&r!==s&&c(n,r,{get:()=>e[r],enumerable:!(o=E(e,r))||o.enumerable});return n};var m=(n,e,s)=>(s=n!=null?d(F(n)):{},a(e||!n||!n.__esModule?c(s,\"default\",{value:n,enumerable:!0}):s,n)),u=n=>a(c({},\"__esModule\",{value:!0}),n);var t=D((k,i)=>{i.exports=_jsx_runtime});var v={};C(v,{default:()=>A,frontmatter:()=>g});var l=m(t()),g={title:\"Monitor Headless Worker Services in .Net Core 5.0\",metaDesc:\"Use health-checks on headless services without needing the entire MVC ecosystem\",date:new Date(16244928e5),tags:[\"c#\"]};function h(n){let e=Object.assign({h1:\"h1\",p:\"p\",strong:\"strong\",h2:\"h2\",a:\"a\",div:\"div\",pre:\"pre\",code:\"code\",span:\"span\"},n.components);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.h1,{id:\"monitor-headless-worker-services-in-net-core-50\",children:\"Monitor Headless Worker Services in .Net Core 5.0\"}),`\n`,(0,l.jsx)(e.p,{children:\"While on a project, we were working with RabbitMQ and a series of consumers. These consumers all ran headlessly(ie no web server), but we wanted an easy was to check the health of them. We are also running in AWS ECS, which supports the notion of health-checks within the ECS cluster itself, and replacing containers that are failing health-checks.\"}),`\n`,(0,l.jsxs)(e.p,{children:[\".Net Core 2.0 introduced us to the idea of a \",(0,l.jsx)(e.strong,{children:\"first class service worker\"}),\". This meant a single process running independently of the main process. This was a great addition because .Net Core finally had a cross-platform solution to the Windows Services of the past. This meant you could now build out business processes to run in a lights out fashion, and potentially run more than one in a single process. If the hosted process exits, you can have the entire process come down with it.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"While the OOTB processes around Hosted Services are fantastic, we wanted something a bit more pro-active other than the process failing completely, and ECS spinning up a new one. MVC style health-checks were what the team decided on, but the first implementation was less than perfect.\"}),`\n`,(0,l.jsx)(e.h2,{id:\"the-problem\",children:\"The Problem\"}),`\n`,(0,l.jsx)(e.p,{children:\"The first attempt simply used the VS2019 MVC project template instead of the more specialized Worker Service project template. This made implementing health-checks a breeze, but our highly specialized queue worker was now pulling double-duty as a full on MVC application. Less than ideal due to system requirements, and now any enterprising developer who knows MVC can easily circumvent our RabbitMQ queues and abuse MVC to get work \\u201Cdone\\u201D. Additionally, the MVC process is the main process and the Hosted Service is now a side process. There is nothing stopping the queue consumer from failing, while the MVC application keeps on serving up Status 200 from the health check endpoint.\"}),`\n`,(0,l.jsx)(e.p,{children:\"How do you utilize the Worker Service project type and expose usable HTTP endpoints without dragging in MVC framework?\"}),`\n`,(0,l.jsx)(e.h2,{id:\"tinyhealthcheck\",children:\"TinyHealthCheck\"}),`\n`,(0,l.jsxs)(e.p,{children:[\"The solution I ultimately came up with was a very small Nuget package called \",(0,l.jsx)(e.a,{href:\"https://github.com/bruceharrison1984/TinyHealthCheck\",children:\"TinyHealthCheck\"}),\". TinyHealthCheck spins up a single endpoint that serves a simple JSON payload to verify your container is indeed running. This health check process runs as an additional IHostedService next to your intended application. The included health-checks are similar to MVC health-checks in that they don\\u2019t pay any attention to the hosted service, but they suffice for most simple scenarios. The upside is your surface are for MVC is now effectively zero, because TinyHealthCheck doesn\\u2019t require any MVC packages. In fact, it only has 2 dependencies related to IOptions and Dependency injection. Web requests are processed in the Global ThreadPool, so your primary process isn\\u2019t constrained by the health-checks. They are also processed in a fire-and-forget manner, so your primary service won\\u2019t be disrupted by failures sending or receiving HTTP requests.\"]}),`\n`,(0,l.jsx)(e.h2,{id:\"simple-example\",children:\"Simple Example\"}),`\n`,(0,l.jsx)(e.p,{children:\"The following example produces a single endpoint that returns a 200 with a small JSON payload.\"}),`\n`,(0,l.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,l.jsx)(e.pre,{\"data-language\":\"c#\",\"data-theme\":\"default\",children:(0,l.jsxs)(e.code,{\"data-language\":\"c#\",\"data-theme\":\"default\",children:[(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"static\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" IHostBuilder \"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"CreateHostBuilder\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"string\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[]\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" args\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"var\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" processStartTime \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"DateTimeOffset\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Now\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"return\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Host\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"CreateDefaultBuilder\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"args\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"ConfigureServices\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"((\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"hostContext\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" services\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=>\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"services\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"AddHostedService\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"Worker\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\">()\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"services\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"AddBasicTinyHealthCheckWithUptime\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"config \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=>\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"config\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Port\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#B48EAD\"},children:\"8081\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"config\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"UrlPath\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"/healthz\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"return\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"config\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"})\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"})\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})})]})})}),`\n`,(0,l.jsx)(e.p,{children:\"The health-check is stateful in that it keeps track of how long the application has been up and running(outside of app-pool restarts).\"}),`\n`,(0,l.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,l.jsx)(e.pre,{\"data-language\":\"json\",\"data-theme\":\"default\",children:(0,l.jsxs)(e.code,{\"data-language\":\"json\",\"data-theme\":\"default\",children:[(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"Status\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Healthy!\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"Uptime\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"<ever increasing timespan>\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})})]})})}),`\n`,(0,l.jsx)(e.h2,{id:\"monitoring-the-primary-process\",children:\"Monitoring the primary process\"}),`\n`,(0,l.jsx)(e.p,{children:(0,l.jsx)(e.a,{href:\"https://github.com/bruceharrison1984/TinyHealthCheck/tree/main/DummyServiceWorker\",children:\"The complete form of this example is available in the repository.\"})}),`\n`,(0,l.jsx)(e.p,{children:\"The real value in using TinyHealthCheck comes from monitoring your primary IHostedService, and representing it\\u2019s current state in the health check. Creating a custom IHealthCheck allows you to implement whatever sort of response you\\u2019d like based on the underlying conditions within the application. The following example shows how utilizing a Singleton to hold the state information of your primary IHostedService, you can easily get run-time information into your health-checks.\"}),`\n`,(0,l.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,l.jsx)(e.pre,{\"data-language\":\"c#\",\"data-theme\":\"default\",children:(0,l.jsxs)(e.code,{\"data-language\":\"c#\",\"data-theme\":\"default\",children:[(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"static\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" IHostBuilder \"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"CreateHostBuilder\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"string\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[]\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" args\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"var\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" processStartTime \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"DateTimeOffset\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Now\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"return\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Host\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"CreateDefaultBuilder\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"args\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"ConfigureServices\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"((\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"hostContext\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" services\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=>\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"services\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"AddSingleton\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"WorkerStateService\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\">()\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"services\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"AddHostedService\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"Worker\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\">()\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"services\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"AddCustomTinyHealthCheck\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"CustomHealthCheck\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\">(\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"config \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=>\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"config\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Port\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#B48EAD\"},children:\"8082\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"config\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"UrlPath\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"/healthz\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"return\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"config\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"})\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"})\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"class\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"CustomHealthCheck\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" IHealthCheck\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"private\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"readonly\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" ILogger\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"CustomHealthCheck\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" _logger\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"private\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"readonly\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" WorkerStateService _workerStateService\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#616E88\"},children:\"//IHostedServices cannot be reliably retrieved from the DI collection\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#616E88\"},children:\"//A secondary stateful service is required in order to get state information out of it\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"CustomHealthCheck\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"ILogger\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"CustomHealthCheck\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" logger\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" WorkerStateService workerStateService\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"_logger\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"logger\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"_workerStateService\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"workerStateService\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"public\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"async\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" Task\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"<\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"HealthCheckResult\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\">\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"Execute\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"CancellationToken cancellationToken\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"_logger\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"LogInformation\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"This is an example of accessing the DI containers for logging. You can access any service that is registered\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"return\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" HealthCheckResult\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Body\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"JsonSerializer\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#88C0D0\"},children:\"Serialize\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"new\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Status\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"_workerStateService\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"IsRunning\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"?\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Healthy!\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Unhealthy!\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Iteration\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"_workerStateService\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Iteration\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"IsServiceRunning\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"_workerStateService\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"IsRunning\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"ErrorMessage\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"_workerStateService\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"IsRunning\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"?\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"null\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"We went over 10 iterations, so the service worker quit!\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}),\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"StatusCode\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"_workerStateService\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"IsRunning\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\"?\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"System\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Net\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"HttpStatusCode\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"OK\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"System\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"Net\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"HttpStatusCode\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9\"},children:\"InternalServerError\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#81A1C1\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})})]})})}),`\n`,(0,l.jsxs)(e.p,{children:[\"It can also be noted that technically you don\\u2019t need to use the Singleton to get state information out of another IHostedService. \",(0,l.jsx)(e.strong,{children:\"You can register a single IHostedService as both an IHostedService, as well as a Singleton.\"}),\" That will allow you to directly access it via DI, but that smells really bad to me. I like the separation of concerns by requiring the IHostedService to post updates to the singleton, and then TinyHealthCheck retrieves values from there. Just my opinion, do what you like.\"]}),`\n`,(0,l.jsx)(e.h2,{id:\"conclusion\",children:\"Conclusion\"}),`\n`,(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.a,{href:\"https://github.com/bruceharrison1984/TinyHealthCheck\",children:\"TinyHealthCheck\"}),\" allowed us to implement full featured health-check endpoints, while getting rid of the overhead and dependencies of the larger MVC ecosystem. Don\\u2019t get me wrong, I love me some MVC, but I don\\u2019t want to double the size of my executable just for a health-check endpoint.\"]})]})}function f(n={}){let{wrapper:e}=n.components||{};return e?(0,l.jsx)(e,Object.assign({},n,{children:(0,l.jsx)(h,n)})):h(n)}var A=f;return u(v);})();\n;return Component;"
  },
  {
    "filepath": "content\\posts\\2022\\debug-storybook-from-vscode-2022.md",
    "url": "posts/2022/debug-storybook-from-vscode-2022",
    "year": 2022,
    "slug": "debug-storybook-from-vscode-2022",
    "hash": "rkaNuRjDDvaCsx8LDTgW2gBEIxY=",
    "pageContent": "var Component=(()=>{var h=Object.create;var r=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty;var C=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),m=(n,e)=>{for(var o in e)r(n,o,{get:e[o],enumerable:!0})},t=(n,e,o,c)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let s of E(e))!y.call(n,s)&&s!==o&&r(n,s,{get:()=>e[s],enumerable:!(c=F(e,s))||c.enumerable});return n};var u=(n,e,o)=>(o=n!=null?h(p(n)):{},t(e||!n||!n.__esModule?r(o,\"default\",{value:n,enumerable:!0}):o,n)),g=n=>t(r({},\"__esModule\",{value:!0}),n);var i=C((w,a)=>{a.exports=_jsx_runtime});var f={};m(f,{default:()=>B,frontmatter:()=>D});var l=u(i()),D={title:\"Debug Storybook from VSCode (2022)\",metaDesc:\"How to get VSCode working together with Storybook for effortless component debugging\",headerImage:\"/assets/posts/2022/debug-storybook-from-vscode-1.png\",date:new Date(16431552e5),tags:[\"vscode\",\"storybook\"]};function d(n){let e=Object.assign({h1:\"h1\",p:\"p\",div:\"div\",pre:\"pre\",code:\"code\",span:\"span\",img:\"img\"},n.components);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.h1,{id:\"debug-storybook-from-vscode-2022\",children:\"Debug Storybook from VSCode (2022)\"}),`\n`,(0,l.jsx)(e.p,{children:\"While working on a small personal project, I had a need to be able to debug Storybook. A quick Google search turned up tons of blogs that were many years out of date. I knew there had to be an easier way, and there was!\"}),`\n`,(0,l.jsx)(e.p,{children:\"After a bit of playing around, the following simple setup allowed me to set breakpoints and debug React components hosted in Storybook, from within VSCode. You do not need to install the Debugger for Chrome extension!\"}),`\n`,(0,l.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,l.jsx)(e.pre,{\"data-language\":\"json\",\"data-theme\":\"default\",children:(0,l.jsxs)(e.code,{\"data-language\":\"json\",\"data-theme\":\"default\",children:[(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"version\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"0.2.0\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"configurations\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"[\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"name\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Storybook Debug\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"type\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"node-terminal\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"request\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"launch\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"command\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"npm run storybook\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"internalConsoleOptions\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"openOnFirstSessionStart\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"serverReadyAction\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"{\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"pattern\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"Local:.+(https?://[^:]+:[0-9]+)\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"uriFormat\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"%s\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8FBCBB\"},children:\"action\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#A3BE8C\"},children:\"debugWithChrome\"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:'\"'})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#D8DEE9FF\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"]\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#ECEFF4\"},children:\"}\"})})]})})}),`\n`,(0,l.jsx)(e.p,{children:\"Once you\\u2019ve added the Storybook Debug configuration to your launch.json, you should be able to run it from the debug menu.\"}),`\n`,(0,l.jsx)(e.p,{children:(0,l.jsx)(e.img,{src:\"/assets/posts/2022/debug-storybook-from-vscode-1.png\",alt:\"Image1\",width:\"381\",height:\"190\"})}),`\n`,(0,l.jsx)(e.p,{children:\"Assuming your components compile and Storybook launches successfully, Chrome will automatically open up and with the debugger attached. Now you can easily debug your components running in Storybook with VSCode.\"}),`\n`,(0,l.jsx)(e.p,{children:(0,l.jsx)(e.img,{src:\"/assets/posts/2022/debug-storybook-from-vscode-2.png\",alt:\"Image1\",width:\"500\",height:\"595\"})}),`\n`,(0,l.jsx)(e.p,{children:\"This configuration should continue to work for the foreseeable future, or at least until Storybook changes the message that appears in the terminal once it\\u2019s up an running. I had this working with Storybook 6.4.14. If it changes in the future, alter the serverReadyAction:pattern regex setting so it can match the new terminal output.\"}),`\n`,(0,l.jsx)(e.p,{children:\"Note: There seems to be an issue with debugging and the Storybook webpack@5 experimental mode. I had to drop back to webpack@4 in order to get debugging working as described here.\"}),`\n`,(0,l.jsx)(e.p,{children:\"Happy coding!\"})]})}function b(n={}){let{wrapper:e}=n.components||{};return e?(0,l.jsx)(e,Object.assign({},n,{children:(0,l.jsx)(d,n)})):d(n)}var B=b;return g(f);})();\n;return Component;"
  }
]